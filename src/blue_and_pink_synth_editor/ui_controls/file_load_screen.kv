#:kivy 2.1.0
#:import C kivy.utils.get_color_from_hex
#:import SlideTransition kivy.uix.screenmanager.SlideTransition
#:import NoTransition kivy.uix.screenmanager.NoTransition


<FileLoadScreen>:
    name: 'file_load'
    corner_radius: self.height * 0.015

    canvas.before:
        Color:
            rgba: C('#092042FF')

        SmoothRectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: (root.height * 0.008, 0, root.height * 0.008, root.height * 0.008)
        spacing: root.height * 0.008

        # Top Bar
        FileLoadScreenTopBar:
            size_hint_y: 3/40
            corner_radius: root.corner_radius
            screen_name: root.name

        # Main Controls
        BoxLayout:
            orientation: 'horizontal'
            spacing: root.height * 0.008

            # File Load
            BoxLayout:
                orientation: 'vertical'
                padding: (root.height * 0.008, 0, root.height * 0.008, root.height * 0.008)
                spacing: root.height * 0.008
                corner_radius: root.corner_radius

                canvas.before:
                    Color:
                        rgba: C('#103771FF')

                    SmoothRoundedRectangle:
                        pos: self.pos
                        size: self.width, self.height
                        radius: [root.height * 0.015]

                PresetFileChooser:
                    spacing: root.height * 0.008
                    corner_radius: root.corner_radius

            # Preset Slots
            BoxLayout:
                orientation: 'vertical'
                padding: (root.height * 0.008, 0, root.height * 0.008, root.height * 0.008)
                spacing: root.height * 0.008
                corner_radius: root.corner_radius

                canvas.before:
                    Color:
                        rgba: C('#257CFFFF')

                    SmoothRoundedRectangle:
                        pos: self.pos
                        size: self.width, self.height
                        radius: [root.height * 0.015]


<FileButton@ButtonBehavior+Label>:
    corner_radius: 0
    canvas.before:
        Color:
            rgba: C('#257CFFFF') if not root.disabled else C('#43454AFF')

        SmoothRoundedRectangle:
            pos: self.pos
            size: self.width, self.height
            radius: [self.corner_radius]


<FileLoadScreenTopBar>:
    orientation: 'horizontal'
    padding: [0, 0, self.width * 0.01, 0]
    spacing: self.parent.spacing
    screen_name: 'file_load'

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        SmoothRoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [0, 0, root.corner_radius, root.corner_radius]

    Label:
        text: 'LOAD PRESET'
        size_hint_y: None
        height: self.parent.height
        font_size: self.height * 0.5
        color: C('#06070FFF')
        text_size: self.size
        halign: 'center'
        valign: 'middle'

    TopBarButton:
        screen_name: root.screen_name
        size_hint_x: 3/20
        text: 'CANCEL'
        tooltip_text: ''
        halign: 'right'
        on_release:
            app.root.transition = NoTransition()
            app.root.current = 'main'
            app.set_curr_screen_name('main')
            self.mouse_inside_bounds = False


<TopBarButton@HoverButton>:
    size_hint_x: 1/6
    size_hint_y: None
    height: self.parent.height
    color: C('#ECBFEBFF') if self.mouse_pressed else C('#06070FFF')
    base_font_size: self.height * 0.45
    text_size: self.size
    halign: 'center'
    valign: 'middle'

<PresetFileChooser@BoxLayout>:
    orientation: 'vertical'
    spacing: 0
    padding: 0
    corner_radius: 0

    FileChooserListView:
        id: filechooser
        args_converter: lambda row_index, rec: {'name': rec['name']}
        path: str(app._curr_preset_file_path.parent if app._curr_preset_file_path is not None else app._presets_directory_path)
        dirselect: False
        filters: ['*.txt', '*.TXT']
        sort_func: app.file_list_sort_func

    FileButton:
        corner_radius: root.corner_radius
        size_hint_y: 1/10
        text_size: self.size
        font_size: self.height * 0.3
        halign: 'center'
        valign: 'middle'
        text: "LOAD FILE"
        disabled: len(filechooser.selection) == 0
        on_release:
            app.on_file_load_dialog(filechooser.path, filechooser.selection)
            app.root.transition = NoTransition()
            app.root.current = 'main'
            app.set_curr_screen_name('main')
            self.mouse_inside_bounds = False