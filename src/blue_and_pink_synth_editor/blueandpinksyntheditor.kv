#:kivy 2.1.0
#:import C kivy.utils.get_color_from_hex
#:import SlideTransition kivy.uix.screenmanager.SlideTransition

ScreenManager:
    DashboardScreen
    SettingsScreen
    ChordsScreen


<DashboardScreen@Screen>:
    name: 'dashboard'

    canvas.before:
        Color:
            rgba: C('#092042FF')
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: (root.height * 0.008, 0, root.height * 0.008, root.height * 0.008)
        spacing: root.height * 0.008

        # Top Bar
        TopBar:
            size_hint_y: 3/40
            corner_radius: root.height * 0.015

        MainControlsBox:
            size_hint_y: 35/40
            corner_radius: root.height * 0.015

        BottomBar:
            size_hint_y: 2/40
            corner_radius: root.height * 0.015


<SettingsScreen@Screen>:
    name: 'settings'

    canvas.before:
        Color:
            rgba: C('#092042FF')
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: (app.curr_height * 0.008, 0, app.curr_height * 0.008, app.curr_height * 0.008)
        spacing: app.curr_height * 0.008

        # Top Bar
        SettingsTopBar:
            size_hint: 1, 1/10
            corner_radius: root.height * 0.015

        MainSettingsBox:
            orientation: 'horizontal'
            spacing: app.curr_height * 0.008
            size_hint: 1, 5/10
            corner_radius: root.height * 0.015

            NymphesPortsSection:
                size_hint_x: 1/3

            MidiInputPortsSection:
                size_hint_x: 1/3

            MidiOutputPortsSection:
                size_hint_x: 1/3

        Widget:
            size_hint_y: 4/10
#            canvas.before:
#                Color:
#                    rgba: C('#00FF0050')
#
#                Rectangle:
#                    pos: self.pos
#                    size: self.width, self.height


<ChordsScreen@Screen>:
    name: 'chords'

    canvas.before:
        Color:
            rgba: C('#092042FF')
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: (root.height * 0.008, 0, root.height * 0.008, root.height * 0.008)
        spacing: root.height * 0.008

        # Top Bar
        ChordsTopBar:
            size_hint_y: 3/40
            corner_radius: root.height * 0.015

        ChordsMainControlsBox:
            size_hint_y: 35/40
            corner_radius: root.height * 0.015

        BottomBar:
            size_hint_y: 2/40
            corner_radius: root.height * 0.015


<ChordsTopBar>:
    orientation: 'horizontal'
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]
    spacing: self.parent.spacing

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [0, 0, root.corner_radius, root.corner_radius]

    Widget:
        size_hint_x: 15/20

    TopBarButton:
        size_hint_x: 3/20
        on_release:
            app.root.transition = SlideTransition(direction='left')
            app.root.current = 'settings'
        text: 'SETTINGS'

    TopBarButton:
        size_hint_x: 2/20
        on_release:
            app.root.transition = SlideTransition(direction='right')
            app.root.current = 'dashboard'
        text: 'BACK'


<ChordsMainControlsBox>:
    orientation: 'horizontal'
    spacing: self.parent.spacing

    ChordsControlSectionsGrid:
        cols: 2
        spacing: self.parent.spacing
        corner_radius: self.parent.corner_radius

        canvas.before:
            Color:
                rgba: C('#500000FF')
            Rectangle:
                pos: self.pos
                size: self.size

        # Row 1
        Chord1ControlSection:
            size_hint_y: 1/4

        Chord2ControlSection:
            size_hint_y: 1/4

        # Row 2
        Chord3ControlSection:
            size_hint_y: 1/4

        Chord4ControlSection:
            size_hint_y: 1/4

        # Row 3
        Chord5ControlSection:
            size_hint_y: 1/4

        Chord6ControlSection:
            size_hint_y: 1/4

        # Row 4
        Chord7ControlSection:
            size_hint_y: 1/4

        Chord8ControlSection:
            size_hint_y: 1/4


<Chord1ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 1 (0-9)'
        this_chord_active: 0 <= app.pitch_chord_value <= 9

    ChordParamsGrid:

        ChordParamsGridCell:
            section_name: 'chord_1'
            title: 'ROOT'
            param_name: 'chord_1.root.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_1_root_value

        ChordParamsGridCell:
            section_name: 'chord_1'
            title: 'SEMI 1'
            param_name: 'chord_1.semi_1.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_1_semi_1_value
            
        ChordParamsGridCell:
            section_name: 'chord_1'
            title: 'SEMI 2'
            param_name: 'chord_1.semi_2.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_1_semi_2_value
            
        ChordParamsGridCell:
            section_name: 'chord_1'
            title: 'SEMI 3'
            param_name: 'chord_1.semi_3.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_1_semi_3_value

        ChordParamsGridCell:
            section_name: 'chord_1'
            title: 'SEMI 4'
            param_name: 'chord_1.semi_4.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_1_semi_4_value

        ChordParamsGridCell:
            section_name: 'chord_1'
            title: 'SEMI 5'
            param_name: 'chord_1.semi_5.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_1_semi_5_value
            

<Chord2ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 2 (10-27)'
        this_chord_active: 10 <= app.pitch_chord_value <= 27

    ChordParamsGrid:

        ChordParamsGridCell:
            section_name: 'chord_2'
            title: 'ROOT'
            param_name: 'chord_2.root.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_2_root_value

        ChordParamsGridCell:
            section_name: 'chord_2'
            title: 'SEMI 1'
            param_name: 'chord_2.semi_1.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_2_semi_1_value
            
        ChordParamsGridCell:
            section_name: 'chord_2'
            title: 'SEMI 2'
            param_name: 'chord_2.semi_2.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_2_semi_2_value
            
        ChordParamsGridCell:
            section_name: 'chord_2'
            title: 'SEMI 3'
            param_name: 'chord_2.semi_3.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_2_semi_3_value

        ChordParamsGridCell:
            section_name: 'chord_2'
            title: 'SEMI 4'
            param_name: 'chord_2.semi_4.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_2_semi_4_value

        ChordParamsGridCell:
            section_name: 'chord_2'
            title: 'SEMI 5'
            param_name: 'chord_2.semi_5.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_2_semi_5_value


<Chord3ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 3 (28-45)'
        this_chord_active: 28 <= app.pitch_chord_value <= 45

    ChordParamsGrid:

        ChordParamsGridCell:
            section_name: 'chord_3'
            title: 'ROOT'
            param_name: 'chord_3.root.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_3_root_value

        ChordParamsGridCell:
            section_name: 'chord_3'
            title: 'SEMI 1'
            param_name: 'chord_3.semi_1.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_3_semi_1_value
            
        ChordParamsGridCell:
            section_name: 'chord_3'
            title: 'SEMI 2'
            param_name: 'chord_3.semi_2.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_3_semi_2_value
            
        ChordParamsGridCell:
            section_name: 'chord_3'
            title: 'SEMI 3'
            param_name: 'chord_3.semi_3.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_3_semi_3_value

        ChordParamsGridCell:
            section_name: 'chord_3'
            title: 'SEMI 4'
            param_name: 'chord_3.semi_4.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_3_semi_4_value

        ChordParamsGridCell:
            section_name: 'chord_3'
            title: 'SEMI 5'
            param_name: 'chord_3.semi_5.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_3_semi_5_value


<Chord4ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 4 (46-63)'
        this_chord_active: 46 <= app.pitch_chord_value <= 63

    ChordParamsGrid:

        ChordParamsGridCell:
            section_name: 'chord_4'
            title: 'ROOT'
            param_name: 'chord_4.root.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_4_root_value

        ChordParamsGridCell:
            section_name: 'chord_4'
            title: 'SEMI 1'
            param_name: 'chord_4.semi_1.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_4_semi_1_value
            
        ChordParamsGridCell:
            section_name: 'chord_4'
            title: 'SEMI 2'
            param_name: 'chord_4.semi_2.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_4_semi_2_value
            
        ChordParamsGridCell:
            section_name: 'chord_4'
            title: 'SEMI 3'
            param_name: 'chord_4.semi_3.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_4_semi_3_value

        ChordParamsGridCell:
            section_name: 'chord_4'
            title: 'SEMI 4'
            param_name: 'chord_4.semi_4.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_4_semi_4_value

        ChordParamsGridCell:
            section_name: 'chord_4'
            title: 'SEMI 5'
            param_name: 'chord_4.semi_5.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_4_semi_5_value
          
          
<Chord5ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 5 (64-81)'
        this_chord_active: 64 <= app.pitch_chord_value <= 81

    ChordParamsGrid:

        ChordParamsGridCell:
            section_name: 'chord_5'
            title: 'ROOT'
            param_name: 'chord_5.root.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_5_root_value

        ChordParamsGridCell:
            section_name: 'chord_5'
            title: 'SEMI 1'
            param_name: 'chord_5.semi_1.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_5_semi_1_value
            
        ChordParamsGridCell:
            section_name: 'chord_5'
            title: 'SEMI 2'
            param_name: 'chord_5.semi_2.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_5_semi_2_value
            
        ChordParamsGridCell:
            section_name: 'chord_5'
            title: 'SEMI 3'
            param_name: 'chord_5.semi_3.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_5_semi_3_value

        ChordParamsGridCell:
            section_name: 'chord_5'
            title: 'SEMI 4'
            param_name: 'chord_5.semi_4.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_5_semi_4_value

        ChordParamsGridCell:
            section_name: 'chord_5'
            title: 'SEMI 5'
            param_name: 'chord_5.semi_5.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_5_semi_5_value  


<Chord6ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 6 (82-99)'
        this_chord_active: 82 <= app.pitch_chord_value <= 99

    ChordParamsGrid:

        ChordParamsGridCell:
            section_name: 'chord_6'
            title: 'ROOT'
            param_name: 'chord_6.root.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_6_root_value

        ChordParamsGridCell:
            section_name: 'chord_6'
            title: 'SEMI 1'
            param_name: 'chord_6.semi_1.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_6_semi_1_value
            
        ChordParamsGridCell:
            section_name: 'chord_6'
            title: 'SEMI 2'
            param_name: 'chord_6.semi_2.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_6_semi_2_value
            
        ChordParamsGridCell:
            section_name: 'chord_6'
            title: 'SEMI 3'
            param_name: 'chord_6.semi_3.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_6_semi_3_value

        ChordParamsGridCell:
            section_name: 'chord_6'
            title: 'SEMI 4'
            param_name: 'chord_6.semi_4.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_6_semi_4_value

        ChordParamsGridCell:
            section_name: 'chord_6'
            title: 'SEMI 5'
            param_name: 'chord_6.semi_5.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_6_semi_5_value


<Chord7ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 7 (100-117)'
        this_chord_active: 100 <= app.pitch_chord_value <= 117

    ChordParamsGrid:

        ChordParamsGridCell:
            section_name: 'chord_7'
            title: 'ROOT'
            param_name: 'chord_7.root.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_7_root_value

        ChordParamsGridCell:
            section_name: 'chord_7'
            title: 'SEMI 1'
            param_name: 'chord_7.semi_1.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_7_semi_1_value
            
        ChordParamsGridCell:
            section_name: 'chord_7'
            title: 'SEMI 2'
            param_name: 'chord_7.semi_2.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_7_semi_2_value
            
        ChordParamsGridCell:
            section_name: 'chord_7'
            title: 'SEMI 3'
            param_name: 'chord_7.semi_3.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_7_semi_3_value

        ChordParamsGridCell:
            section_name: 'chord_7'
            title: 'SEMI 4'
            param_name: 'chord_7.semi_4.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_7_semi_4_value

        ChordParamsGridCell:
            section_name: 'chord_7'
            title: 'SEMI 5'
            param_name: 'chord_7.semi_5.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_7_semi_5_value


<Chord8ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 8 (118-127)'
        this_chord_active: 118 <= app.pitch_chord_value <= 127

    ChordParamsGrid:

        ChordParamsGridCell:
            section_name: 'chord_8'
            title: 'ROOT'
            param_name: 'chord_8.root.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_8_root_value

        ChordParamsGridCell:
            section_name: 'chord_8'
            title: 'SEMI 1'
            param_name: 'chord_8.semi_1.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_8_semi_1_value
            
        ChordParamsGridCell:
            section_name: 'chord_8'
            title: 'SEMI 2'
            param_name: 'chord_8.semi_2.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_8_semi_2_value
            
        ChordParamsGridCell:
            section_name: 'chord_8'
            title: 'SEMI 3'
            param_name: 'chord_8.semi_3.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_8_semi_3_value

        ChordParamsGridCell:
            section_name: 'chord_8'
            title: 'SEMI 4'
            param_name: 'chord_8.semi_4.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_8_semi_4_value

        ChordParamsGridCell:
            section_name: 'chord_8'
            title: 'SEMI 5'
            param_name: 'chord_8.semi_5.value'
            background_color_string: '#438EFFFF'
            value_prop: app.chord_8_semi_5_value
            

<SettingsTopBar>:
    orientation: 'horizontal'
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]
    spacing: self.parent.spacing

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [0, 0, root.corner_radius, root.corner_radius]

    Widget:
        size_hint_x: 5/6

    TopBarButton:
        on_release:
            app.root.transition = SlideTransition(direction='right')
            app.root.current = 'dashboard'
        text: 'BACK'


<TopBar>:
    orientation: 'horizontal'
    padding: [self.corner_radius * 0, self.corner_radius * 0]
    spacing: self.parent.spacing

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [0, 0, root.corner_radius, root.corner_radius]

    PresetIncButton:
        size_hint_x: 1/20
        text: '-'
        font_size: self.height * 1.2
        on_release: app.load_prev_preset()

    TopBarSpinner:
        size_hint_x: 7/20
        values: app.presets_spinner_values
        text: app.presets_spinner_text
        on_text: app.presets_spinner_text_changed(self.values.index(self.text), self.text)

    PresetIncButton:
        size_hint_x: 1/20
        text: '+'
        on_release: app.load_next_preset()

    TopBarButton:
        size_hint_x: 2/20
        text: 'SAVE'
        on_release: app.update_current_preset()
        disabled: not app.nymphes_connected or app.unsaved_preset_changes == False

    TopBarButton:
        size_hint_x: 2/20
        text: 'REVERT'
        on_release: app.reload()
        disabled: not app.nymphes_connected or app.curr_preset_type == '' or app.unsaved_preset_changes == False

    Widget:
        size_hint_x: 1/20

    TopBarButton:
        size_hint_x: 2/20
        text: 'OPEN'
        on_release: app.show_load_dialog()
        disabled: not app.nymphes_connected

    TopBarButton:
        size_hint_x: 2/20
        text: 'SAVE AS'
        on_release: app.show_save_dialog()
        disabled: not app.nymphes_connected

    Widget:
        size_hint_x: 1/20

    TopBarButton:
        size_hint_x: 3/20
        on_release:
            app.root.transition = SlideTransition(direction='left')
            app.root.current = 'settings'
        text: 'SETTINGS'


<MainControlsBox>:
    orientation: 'horizontal'
    spacing: self.parent.spacing

#    canvas.before:
#        Color:
#            rgba: C('#0000FFFF')
#        Rectangle:
#            pos: self.pos
#            size: self.size

    LeftBar:
        size_hint: 1/12, 1

    ControlSectionsGrid:
        cols: 2
        spacing: self.parent.spacing
        corner_radius: self.parent.corner_radius

#        canvas.before:
#            Color:
#                rgba: C('#00FFFFFF')
#            Rectangle:
#                pos: self.pos
#                size: self.size

        # Top Row
        OscillatorControlSection:
            size_hint_y: 2/4

        FilterControlSection:
            size_hint_y: 2/4

        # Middle Row
        AmpControlSection:
            size_hint_y: 1/4

        Lfo1ControlSection:
            size_hint_y: 1/5

        # Bottom Row
        ReverbControlSection:
            size_hint_y: 1/4

        Lfo2ControlSection:
            size_hint_y: 1/4


<LeftBar>:
    orientation: 'vertical'
    id: left_bar
    corner_radius: self.parent.corner_radius
    spacing: self.parent.spacing

#    canvas.before:
#        Color:
#            rgba: C('#F000F0FF')
#        Rectangle:
#            pos: self.pos
#            size: self.size

    # Voice Mode Box
    VoiceModeBox:
        size_hint: 1, 19/28
        corner_radius: root.corner_radius

    LegatoBox:
        size_hint: 1, 3/28
        corner_radius: root.corner_radius

    ChordsButtonBox:
        size_hint: 1, 3/28
        corner_radius: root.corner_radius

    FineModeBox:
        size_hint: 1, 3/28
        corner_radius: root.corner_radius


<VoiceModeBox>:
    orientation: 'vertical'
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    VoiceModeButton:
        voice_mode_name: 'POLY'

    VoiceModeButton:
        voice_mode_name: 'UNI-A'

    VoiceModeButton:
        voice_mode_name: 'UNI-B'

    VoiceModeButton:
        voice_mode_name: 'TRI'

    VoiceModeButton:
        voice_mode_name: 'DUO'

    VoiceModeButton:
        voice_mode_name: 'MONO'

<VoiceModeButton>:
    text: self.voice_mode_name
    size_hint: 1, 1 / self.parent.num_voice_modes
    color: C('#ECBFEBFF') if app.voice_mode_name == self.voice_mode_name else C('#06070FFF')
    font_size: (self.height * 0.4) if app.voice_mode_name == self.voice_mode_name else (self.height * 0.35)
    on_release: app.set_voice_mode_by_name(self.voice_mode_name)
    disabled: not app.nymphes_connected


<LegatoBox>:
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    LegatoButton

<LegatoButton@ButtonBehavior+Label>:
    text: 'LEGATO'
    size_hint: 1, 1
    color: C('#ECBFEBFF') if app.legato else C('#06070FFF')
    font_size: (self.height * 0.375) if app.legato else (self.height * 0.35)
    on_release: app.set_legato(not app.legato)
    disabled: not app.nymphes_connected


<ChordsButtonBox>:
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordsButton

<ChordsButton@ButtonBehavior+Label>:
    text: 'CHORDS'
    size_hint: 1, 1
    color: C('#06070FFF')
    font_size: self.height * 0.35
    on_release:
        app.root.transition = SlideTransition(direction='left')
        app.root.current = 'chords'
    disabled: not app.nymphes_connected

<FineModeBox>:
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    FineModeButton

<FineModeButton@ButtonBehavior+Label>:
    text: 'FINE MODE'
    size_hint: 1, 1
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    color: C('#ECBFEBFF') if app.fine_mode else C('#06070FFF')
    font_size: (self.height * 0.4) if app.fine_mode else (self.height * 0.35)
    on_release: app.set_fine_mode(not app.fine_mode)
    disabled: not app.nymphes_connected

<ControlSection>:
    orientation: 'vertical'
    corner_radius: self.parent.corner_radius
    padding: [self.corner_radius * 0.5, 0, self.corner_radius * 0.5, self.corner_radius * 0.5]

<SectionTitleLabel>:
    size_hint_y: None
    height: app.curr_height * 1/16
    background_color: 0, 1, 0, 0.3
    color: C('#000000FF') if app.nymphes_connected else C('#ECBFEBFF')
    font_size: self.height * 0.5
    text_size: self.size
    halign: 'left'
    valign: 'middle'
    disabled: not app.nymphes_connected


<ParamNameLabel>:
    background_color: 1, 1, 0, 0.7
    color: C(self.text_color_string) if app.nymphes_connected else C('#ECBFEBFF')
    font_size: self.width * 0.3
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    disabled: not app.nymphes_connected

<FloatParamValueLabel>:
    background_color: 0, 1, 1, 0.7
    color: C(self.text_color_string) if app.nymphes_connected else C('#ECBFEBFF')
    font_size: self.width * 0.35
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    on_press: app.label_clicked(self.param_name)
    on_touch_down: if self.collide_point(*args[1].pos): self.handle_touch(args[1].device, args[1].button)
    disabled: not app.nymphes_connected


<IntParamValueLabel>:
    background_color: 0, 1, 1, 0.7
    color: C('#06070FFF') if app.nymphes_connected else C('#ECBFEBFF')
    font_size: self.width * 0.35
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    on_press: app.label_clicked(self.param_name)
    on_touch_down: if self.collide_point(*args[1].pos): self.handle_touch(args[1].device, args[1].button)
    disabled: not app.nymphes_connected


<OscillatorControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    SectionTitleLabel:
        text: 'OSCILLATOR'

    ParamsGrid:
        # Top Row
        #
        ParamsGridModCell:
            section_name: 'oscillator_top_row'
            title: 'PW'
            param_name: 'osc.pulsewidth'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.osc_pulsewidth_value
            lfo2_prop: app.osc_pulsewidth_lfo2
            mod_wheel_prop: app.osc_pulsewidth_mod_wheel
            velocity_prop: app.osc_pulsewidth_velocity
            aftertouch_prop: app.osc_pulsewidth_aftertouch

        ParamsGridModCell:
            section_name: 'oscillator_top_row'
            title: 'GLD'
            param_name: 'pitch.glide'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.pitch_glide_value
            lfo2_prop: app.pitch_glide_lfo2
            mod_wheel_prop: app.pitch_glide_mod_wheel
            velocity_prop: app.pitch_glide_velocity
            aftertouch_prop: app.pitch_glide_aftertouch

        ParamsGridModCell:
            section_name: 'oscillator_top_row'
            title: 'DTN'
            param_name: 'pitch.detune'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.pitch_detune_value
            lfo2_prop: app.pitch_detune_lfo2
            mod_wheel_prop: app.pitch_detune_mod_wheel
            velocity_prop: app.pitch_detune_velocity
            aftertouch_prop: app.pitch_detune_aftertouch

        ParamsGridModCell:
            section_name: 'oscillator_top_row'
            title: 'CHD'
            param_name: 'pitch.chord'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.pitch_chord_value
            lfo2_prop: app.pitch_chord_lfo2
            mod_wheel_prop: app.pitch_chord_mod_wheel
            velocity_prop: app.pitch_chord_velocity
            aftertouch_prop: app.pitch_chord_aftertouch

        ParamsGridModCell:
            section_name: 'oscillator_top_row'
            title: 'EG'
            param_name: 'pitch.eg'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#0010EEFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.pitch_eg_value
            lfo2_prop: app.pitch_eg_lfo2
            mod_wheel_prop: app.pitch_eg_mod_wheel
            velocity_prop: app.pitch_eg_velocity
            aftertouch_prop: app.pitch_eg_aftertouch

        # Bottom Row
        #
        ParamsGridModCell:
            section_name: 'oscillator_bottom_row'
            title: 'WAVE'
            param_name: 'osc.wave'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.osc_wave_value
            lfo2_prop: app.osc_wave_lfo2
            mod_wheel_prop: app.osc_wave_mod_wheel
            velocity_prop: app.osc_wave_velocity
            aftertouch_prop: app.osc_wave_aftertouch

        ParamsGridModCell:
            section_name: 'oscillator_bottom_row'
            title: 'LVL'
            param_name: 'mix.osc'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.mix_osc_value
            lfo2_prop: app.mix_osc_lfo2
            mod_wheel_prop: app.mix_osc_mod_wheel
            velocity_prop: app.mix_osc_velocity
            aftertouch_prop: app.mix_osc_aftertouch

        ParamsGridModCell:
            section_name: 'oscillator_bottom_row'
            title: 'SUB'
            param_name: 'mix.sub'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.mix_sub_value
            lfo2_prop: app.mix_sub_lfo2
            mod_wheel_prop: app.mix_sub_mod_wheel
            velocity_prop: app.mix_sub_velocity
            aftertouch_prop: app.mix_sub_aftertouch

        ParamsGridModCell:
            section_name: 'oscillator_bottom_row'
            title: 'NOISE'
            param_name: 'mix.noise'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.mix_noise_value
            lfo2_prop: app.mix_noise_lfo2
            mod_wheel_prop: app.mix_noise_mod_wheel
            velocity_prop: app.mix_noise_velocity
            aftertouch_prop: app.mix_noise_aftertouch

        ParamsGridModCell:
            section_name: 'oscillator_bottom_row'
            title: 'LFO1'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#5500EEFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            param_name: 'pitch.lfo1'
            value_prop: app.pitch_lfo1_value
            lfo2_prop: app.pitch_lfo1_lfo2
            mod_wheel_prop: app.pitch_lfo1_mod_wheel
            velocity_prop: app.pitch_lfo1_velocity
            aftertouch_prop: app.pitch_lfo1_aftertouch

<FilterControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    SectionTitleLabel:
        text: 'FILTER'

    ParamsGrid:
        # Top Row
        #
        ParamsGridModCell:
            section_name: 'filter_top_row'
            title: 'CUT'
            param_name: 'lpf.cutoff'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.lpf_cutoff_value
            lfo2_prop: app.lpf_cutoff_lfo2
            mod_wheel_prop: app.lpf_cutoff_mod_wheel
            velocity_prop: app.lpf_cutoff_velocity
            aftertouch_prop: app.lpf_cutoff_aftertouch

        ParamsGridModCell:
            section_name: 'filter_top_row'
            title: 'RES'
            param_name: 'lpf.resonance'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.lpf_resonance_value
            lfo2_prop: app.lpf_resonance_lfo2
            mod_wheel_prop: app.lpf_resonance_mod_wheel
            velocity_prop: app.lpf_resonance_velocity
            aftertouch_prop: app.lpf_resonance_aftertouch

        ParamsGridModCell:
            section_name: 'filter_top_row'
            title: 'TRK'
            param_name: 'lpf.tracking'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.lpf_tracking_value
            lfo2_prop: app.lpf_tracking_lfo2
            mod_wheel_prop: app.lpf_tracking_mod_wheel
            velocity_prop: app.lpf_tracking_velocity
            aftertouch_prop: app.lpf_tracking_aftertouch

        ParamsGridModCell:
            section_name: 'filter_top_row'
            title: 'EG'
            param_name: 'lpf.eg'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#0010EEFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.lpf_eg_value
            lfo2_prop: app.lpf_eg_lfo2
            mod_wheel_prop: app.lpf_eg_mod_wheel
            velocity_prop: app.lpf_eg_velocity
            aftertouch_prop: app.lpf_eg_aftertouch

        ParamsGridModCell:
            section_name: 'filter_top_row'
            title: 'LFO1'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#5500EEFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            param_name: 'lpf.lfo1'
            value_prop: app.lpf_lfo1_value
            lfo2_prop: app.lpf_lfo1_lfo2
            mod_wheel_prop: app.lpf_lfo1_mod_wheel
            velocity_prop: app.lpf_lfo1_velocity
            aftertouch_prop: app.lpf_lfo1_aftertouch

        # Bottom Row
        #
        ParamsGridModCell:
            section_name: 'filter_bottom_row'
            title: 'ATT'
            param_name: 'filter_eg.attack'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#0010EEFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.filter_eg_attack_value
            lfo2_prop: app.filter_eg_attack_lfo2
            mod_wheel_prop: app.filter_eg_attack_mod_wheel
            velocity_prop: app.filter_eg_attack_velocity
            aftertouch_prop: app.filter_eg_attack_aftertouch

        ParamsGridModCell:
            section_name: 'filter_bottom_row'
            title: 'DEC'
            param_name: 'filter_eg.decay'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#0010EEFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.filter_eg_decay_value
            lfo2_prop: app.filter_eg_decay_lfo2
            mod_wheel_prop: app.filter_eg_decay_mod_wheel
            velocity_prop: app.filter_eg_decay_velocity
            aftertouch_prop: app.filter_eg_decay_aftertouch

        ParamsGridModCell:
            section_name: 'filter_bottom_row'
            title: 'SUS'
            param_name: 'filter_eg.sustain'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#0010EEFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.filter_eg_sustain_value
            lfo2_prop: app.filter_eg_sustain_lfo2
            mod_wheel_prop: app.filter_eg_sustain_mod_wheel
            velocity_prop: app.filter_eg_sustain_velocity
            aftertouch_prop: app.filter_eg_sustain_aftertouch

        ParamsGridModCell:
            section_name: 'filter_bottom_row'
            title: 'REL'
            param_name: 'filter_eg.release'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#0010EEFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.filter_eg_release_value
            lfo2_prop: app.filter_eg_release_lfo2
            mod_wheel_prop: app.filter_eg_release_mod_wheel
            velocity_prop: app.filter_eg_release_velocity
            aftertouch_prop: app.filter_eg_release_aftertouch

        ParamsGridModCell:
            section_name: 'filter_bottom_row'
            title: 'HPF'
            param_name: 'hpf.cutoff'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.hpf_cutoff_value
            lfo2_prop: app.hpf_cutoff_lfo2
            mod_wheel_prop: app.hpf_cutoff_mod_wheel
            velocity_prop: app.hpf_cutoff_velocity
            aftertouch_prop: app.hpf_cutoff_aftertouch

<Lfo1ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    SectionTitleLabel:
        text: 'LFO1'

    ParamsGrid:
        # Top Row
        ParamsGridModCell:
            section_name: 'lfo1'
            title: 'RATE'
            param_name: 'lfo1.rate'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#5500EEFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.lfo1_rate_value
            lfo2_prop: app.lfo1_rate_lfo2
            mod_wheel_prop: app.lfo1_rate_mod_wheel
            velocity_prop: app.lfo1_rate_velocity
            aftertouch_prop: app.lfo1_rate_aftertouch

        ParamsGridModCell:
            section_name: 'lfo1'
            title: 'WAVE'
            param_name: 'lfo1.wave'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#5500EEFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.lfo1_wave_value
            lfo2_prop: app.lfo1_wave_lfo2
            mod_wheel_prop: app.lfo1_wave_mod_wheel
            velocity_prop: app.lfo1_wave_velocity
            aftertouch_prop: app.lfo1_wave_aftertouch

        ParamsGridModCell:
            section_name: 'lfo1'
            title: 'DEL'
            param_name: 'lfo1.delay'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#5500EEFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.lfo1_delay_value
            lfo2_prop: app.lfo1_delay_lfo2
            mod_wheel_prop: app.lfo1_delay_mod_wheel
            velocity_prop: app.lfo1_delay_velocity
            aftertouch_prop: app.lfo1_delay_aftertouch

        ParamsGridModCell:
            section_name: 'lfo1'
            title: 'FADE'
            param_name: 'lfo1.fade'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#5500EEFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.lfo1_fade_value
            lfo2_prop: app.lfo1_fade_lfo2
            mod_wheel_prop: app.lfo1_fade_mod_wheel
            velocity_prop: app.lfo1_fade_velocity
            aftertouch_prop: app.lfo1_fade_aftertouch

        ParamsGridLfoConfigCell:
            section_name: 'lfo1'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#5500EEFF'
            type_prop: app.lfo1_type_value
            key_sync_prop: app.lfo1_key_sync_value


<AmpControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    SectionTitleLabel:
        text: 'AMP'

    ParamsGrid:
        ParamsGridModCell:
            section_name: 'amp'
            title: 'ATT'
            param_name: 'amp_eg.attack'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.amp_eg_attack_value
            lfo2_prop: app.amp_eg_attack_lfo2
            mod_wheel_prop: app.amp_eg_attack_mod_wheel
            velocity_prop: app.amp_eg_attack_velocity
            aftertouch_prop: app.amp_eg_attack_aftertouch

        ParamsGridModCell:
            section_name: 'amp'
            title: 'DEC'
            param_name: 'amp_eg.decay'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.amp_eg_decay_value
            lfo2_prop: app.amp_eg_decay_lfo2
            mod_wheel_prop: app.amp_eg_decay_mod_wheel
            velocity_prop: app.amp_eg_decay_velocity
            aftertouch_prop: app.amp_eg_decay_aftertouch

        ParamsGridModCell:
            section_name: 'amp'
            title: 'SUS'
            param_name: 'amp_eg.sustain'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.amp_eg_sustain_value
            lfo2_prop: app.amp_eg_sustain_lfo2
            mod_wheel_prop: app.amp_eg_sustain_mod_wheel
            velocity_prop: app.amp_eg_sustain_velocity
            aftertouch_prop: app.amp_eg_sustain_aftertouch

        ParamsGridModCell:
            section_name: 'amp'
            title: 'REL'
            param_name: 'amp_eg.release'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.amp_eg_release_value
            lfo2_prop: app.amp_eg_release_lfo2
            mod_wheel_prop: app.amp_eg_release_mod_wheel
            velocity_prop: app.amp_eg_release_velocity
            aftertouch_prop: app.amp_eg_release_aftertouch

        ParamsGridNonModCell:
            section_name: 'amp'
            title: 'LVL'
            param_name: 'mix.level'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#ECBFEBFF'
            value_color_string: '#06070FFF'
            value_prop: app.mix_level_value


<ReverbControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    SectionTitleLabel:
        text: 'REVERB'

    ParamsGrid:
        ParamsGridModCell:
            section_name: 'reverb'
            title: 'SIZE'
            param_name: 'reverb.size'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.reverb_size_value
            lfo2_prop: app.reverb_size_lfo2
            mod_wheel_prop: app.reverb_size_mod_wheel
            velocity_prop: app.reverb_size_velocity
            aftertouch_prop: app.reverb_size_aftertouch

        ParamsGridModCell:
            section_name: 'reverb'
            title: 'DEC'
            param_name: 'reverb.decay'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.reverb_decay_value
            lfo2_prop: app.reverb_decay_lfo2
            mod_wheel_prop: app.reverb_decay_mod_wheel
            velocity_prop: app.reverb_decay_velocity
            aftertouch_prop: app.reverb_decay_aftertouch

        ParamsGridModCell:
            section_name: 'reverb'
            title: 'FILT'
            param_name: 'reverb.filter'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.reverb_filter_value
            lfo2_prop: app.reverb_filter_lfo2
            mod_wheel_prop: app.reverb_filter_mod_wheel
            velocity_prop: app.reverb_filter_velocity
            aftertouch_prop: app.reverb_filter_aftertouch

        ParamsGridModCell:
            section_name: 'reverb'
            title: 'MIX'
            param_name: 'reverb.mix'
            background_color_string: '#438EFFFF'
            value_color_string: '#06070FFF'
            param_name_color_string: '#ECBFEBFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.reverb_mix_value
            lfo2_prop: app.reverb_mix_lfo2
            mod_wheel_prop: app.reverb_mix_mod_wheel
            velocity_prop: app.reverb_mix_velocity
            aftertouch_prop: app.reverb_mix_aftertouch

        Widget:
            size_hint: 1, 1

<Lfo2ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    SectionTitleLabel:
        text: 'LFO2'

    ParamsGrid:
        # Top Row
        ParamsGridModCell:
            section_name: 'lfo2'
            title: 'RATE'
            param_name: 'lfo2.rate'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#ECBFEB'
            value_color_string: '#06070FFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.lfo2_rate_value
            lfo2_prop: app.lfo2_rate_lfo2
            mod_wheel_prop: app.lfo2_rate_mod_wheel
            velocity_prop: app.lfo2_rate_velocity
            aftertouch_prop: app.lfo2_rate_aftertouch

        ParamsGridModCell:
            section_name: 'lfo2'
            title: 'WAVE'
            param_name: 'lfo2.wave'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#ECBFEB'
            value_color_string: '#06070FFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.lfo2_wave_value
            lfo2_prop: app.lfo2_wave_lfo2
            mod_wheel_prop: app.lfo2_wave_mod_wheel
            velocity_prop: app.lfo2_wave_velocity
            aftertouch_prop: app.lfo2_wave_aftertouch

        ParamsGridModCell:
            section_name: 'lfo2'
            title: 'DEL'
            param_name: 'lfo2.delay'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#ECBFEB'
            value_color_string: '#06070FFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.lfo2_delay_value
            lfo2_prop: app.lfo2_delay_lfo2
            mod_wheel_prop: app.lfo2_delay_mod_wheel
            velocity_prop: app.lfo2_delay_velocity
            aftertouch_prop: app.lfo2_delay_aftertouch

        ParamsGridModCell:
            section_name: 'lfo2'
            title: 'FADE'
            param_name: 'lfo2.fade'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#ECBFEB'
            value_color_string: '#06070FFF'
            mod_amount_line_background_color_string: '#6AA3F8FF'
            value_prop: app.lfo2_fade_value
            lfo2_prop: app.lfo2_fade_lfo2
            mod_wheel_prop: app.lfo2_fade_mod_wheel
            velocity_prop: app.lfo2_fade_velocity
            aftertouch_prop: app.lfo2_fade_aftertouch

        ParamsGridLfoConfigCell:
            section_name: 'lfo2'
            background_color_string: '#438EFFFF'
            param_name_color_string: '#ECBFEB'
            type_prop: app.lfo2_type_value
            key_sync_prop: app.lfo2_key_sync_value

<ParamsGrid>:
    cols: 5
    corner_radius: self.width * 0.03
    spacing: self.width * 0.01


<ParamsGridModCell>:
    orientation: 'vertical'
    corner_radius: self.parent.corner_radius
    padding: [self.corner_radius * 0.25]
    canvas.before:
        Color:
            rgba: C(self.background_color_string)
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [root.corner_radius]

    ParamNameLabel:
        text: root.title
        text_color_string: root.param_name_color_string

    FloatParamValueLabel:
        text: str(float(root.value_prop))
        param_name: root.param_name
        text_color_string: root.value_color_string

    ModAmountsBox:
        mod_amount_line_background_color_string: root.mod_amount_line_background_color_string
        size_hint_x: 0.75
        pos_hint: {'center_x': 0.5}

        param_name: root.param_name
        lfo2_prop: root.lfo2_prop
        mod_wheel_prop: root.mod_wheel_prop
        velocity_prop: root.velocity_prop
        aftertouch_prop: root.aftertouch_prop


<ModAmountsBox>:
    orientation: 'horizontal'
    spacing: self.height * 0.1
    size_hint: 1, 1

    Lfo2ModAmountLine:
        background_color_string: root.mod_amount_line_background_color_string
        param_name: root.param_name
        mod_type: 'lfo2'
        midi_val: root.lfo2_prop

    WheelModAmountLine:
        background_color_string: root.mod_amount_line_background_color_string
        param_name: root.param_name
        mod_type: 'mod_wheel'
        midi_val: root.mod_wheel_prop

    VelocityModAmountLine:
        background_color_string: root.mod_amount_line_background_color_string
        param_name: root.param_name
        mod_type: 'velocity'
        midi_val: root.velocity_prop

    AftertouchModAmountLine:
        background_color_string: root.mod_amount_line_background_color_string
        param_name: root.param_name
        mod_type: 'aftertouch'
        midi_val: root.aftertouch_prop


<ModAmountLine>:
    canvas:
        # Line Background

        Color:
            rgba: C(self.background_color_string)

        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [self.width * 0.5]

        # Line Which Grows with the Value
        Color:
            rgba: C(root.color_hex) if root.midi_val > 0 else C('#00000000')

        RoundedRectangle:
            pos: self.pos
            size: self.size[0], (root.midi_val / 127.0) * (root.height - root.height * 0.01)
            radius: [self.width * 0.5]

    on_press: app.label_clicked(self.param_name)
    on_touch_down: if self.collide_point(*args[1].pos): self.handle_touch(args[1].device, args[1].button)
    disabled: not app.nymphes_connected


<Lfo2ModAmountLine@ModAmountLine>:
    color_hex: '#F41513FF'


<WheelModAmountLine@ModAmountLine>:
    color_hex: '#FDFF00FF'


<VelocityModAmountLine@ModAmountLine>:
    color_hex: '#00FF1FFF'


<AftertouchModAmountLine@ModAmountLine>:
    color_hex: '#AA00FFFF'


<ParamsGridLfoConfigCell>:
    orientation: 'vertical'
    corner_radius: self.parent.corner_radius
    on_press: app.select_section(self.section_name)
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]
    canvas.before:
        Color:
            rgba: C(self.background_color_string)
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [root.corner_radius]

    ParamNameLabel:
        font_size: self.width * 0.2
        text: 'TYPE'
        text_color_string: root.param_name_color_string

    IntParamValueLabel:
        font_size: self.width * 0.2
        param_name: root.section_name + '.type'
        text_color_string: root.value_color_string
        text: 'BPM' if root.type_prop == 0 else 'LOW' if root.type_prop == 1 else 'HIGH' if root.type_prop == 2 else 'TRACK' if root.type_prop == 3 else ''

    ParamNameLabel:
        font_size: self.width * 0.2
        text: 'SYNC'
        text_color_string: root.param_name_color_string

    IntParamValueLabel:
        font_size: self.width * 0.2
        param_name: root.section_name + '.key_sync'
        text_color_string: root.value_color_string
        text: "ON" if root.key_sync_prop == 1 else "OFF"


<ParamsGridNonModCell>:
    orientation: 'vertical'
    corner_radius: self.parent.corner_radius
    #on_press: app.select_section(self.section_name)
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]
    canvas.before:
        Color:
            rgba: C(self.background_color_string)
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [root.corner_radius]

    ParamNameLabel:
        text: root.title
        text_color_string: root.param_name_color_string

    FloatParamValueLabel:
        text: str(float(root.value_prop))
        param_name: root.param_name
        text_color_string: root.value_color_string

    # A placeholder to take up the empty space in the lower
    # part of the cell
    Widget


<PresetIncButton@ButtonBehavior+Label>:
#    canvas.before:
#        Color:
#            rgba: C('#505050FF')
#        Rectangle:
#            pos: self.pos
#            size: self.width, self.height

    color: C('#000000FF')
    font_size: self.height * 0.7
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    disabled: not app.nymphes_connected


<TopBarSpinner@Spinner>:
    color: C('#000000FF')
    font_size: self.height * 0.6
    text_size: self.size
    size_hint_y: None
    height: self.parent.height
    halign: 'center'
    valign: 'middle'
    background_color: C('#00000000')
    option_cls: 'TopBarSpinnerOption'
    disabled: not app.nymphes_connected


<TopBarSpinnerOption@SpinnerOption>:
    color: C('#000000FF')
    font_size: self.height * 0.75
    text_size: self.size
    size_hint_y: None
    height: app.curr_height * 2/40
    halign: 'center'
    valign: 'middle'
    background_color: C('#1D60C5F5')
    background_normal: ''


<TopBarButton@ButtonBehavior+Label>:
    size_hint_x: 1/6
    size_hint_y: None
    height: self.parent.height
    color: C('#000000FF')
    font_size: self.height * 0.45
    text_size: self.size
    halign: 'center'
    valign: 'middle'


<LoadDialog>:
    orientation: 'vertical'
    FileChooserListView:
        id: filechooser
        path: str(app._presets_directory_path)
    BoxLayout:
        size_hint_y: 1/8
        Button:
            text_size: self.size
            font_size: self.height * 0.3
            halign: 'center'
            valign: 'middle'
            text: "CANCEL"
            on_release: root.cancel()

        Button:
            text_size: self.size
            font_size: self.height * 0.3
            halign: 'center'
            valign: 'middle'
            text: "OK"
            on_release: root.load(filechooser.path, filechooser.selection)


<SaveDialog>:
    text_input: text_input
    orientation: "vertical"
    FileChooserListView:
        id: filechooser
        path: str(app._presets_directory_path)
        on_selection: text_input.text = self.selection and self.selection[0] or ''

    TextInput:
        id: text_input
        text: root.default_filename
        text_size: self.size
        font_size: self.height * 0.3
        halign: 'left'
        valign: 'middle'
        size_hint_y: 1/8
        multiline: False

    BoxLayout:
        size_hint_y: 1/8
        Button:
            text_size: self.size
            font_size: self.height * 0.3
            halign: 'center'
            valign: 'middle'
            text: "CANCEL"
            on_release: root.cancel()

        Button:
            text_size: self.size
            font_size: self.height * 0.3
            halign: 'center'
            valign: 'middle'
            text: "OK"
            on_release: root.save(filechooser.path, filechooser.path + '/' + text_input.text)


<NymphesPortsSection@ControlSection>:
    spacing: self.parent.spacing

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    BoxLayout:
        orientation: 'vertical'

        SectionTitleLabel:
            text: 'NYMPHES'

        GridLayout:
            cols: 2
            row_default_height: app.curr_height * 1/16
            row_force_default: True


            # First Row
            NymphesPortSpinnerLabel:
                text: 'INPUT PORT'
                size_hint_x: 3/8

            NymphesPortSpinner:
                size_hint_x: 5/8
                values: app.nymphes_input_spinner_names
                text: app.nymphes_input_name
                on_text: app.nymphes_input_spinner_text_changed(self.text)

            # Second Row
            NymphesPortSpinnerLabel:
                text: 'OUTPUT PORT'
                size_hint_x: 3/8

            NymphesPortSpinner:
                size_hint_x: 5/8
                values: app.nymphes_output_spinner_names
                text: app.nymphes_output_name
                on_text: app.nymphes_output_spinner_text_changed(self.text)

            # Third Row
            NymphesPortSpinnerLabel:
                text: 'MIDI CHANNEL'
                size_hint_x: 3/8

            NymphesPortSpinner:
                size_hint_x: 5/8
                values: [str(i) for i in range(17)]
                text: str(app.nymphes_midi_channel)
                #on_text: app.nymphes_output_spinner_text_changed(self.text)




<MidiInputPortsSection@ControlSection>:
    spacing: self.parent.spacing

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    BoxLayout:
        orientation: 'vertical'

        SectionTitleLabel:
            text: 'MIDI INPUTS'

        ScrollView:
            do_scroll_x: False
            do_scroll_y: True

            MidiInputPortsGrid:
                size_hint_y: None
                height: self.minimum_height
                midi_ports: app.detected_midi_input_names_for_gui


<MidiOutputPortsSection@ControlSection>:
    spacing: self.parent.spacing

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    BoxLayout:
        orientation: 'vertical'

        SectionTitleLabel:
            text: 'MIDI OUTPUTS'

        ScrollView:
            do_scroll_x: False
            do_scroll_y: True

            MidiOutputPortsGrid:
                size_hint_y: None
                height: self.minimum_height
                midi_ports: app.detected_midi_output_names_for_gui


<MidiInputPortsGrid>:
    row_default_height: app.curr_height * 1/16
    row_force_default: True


<MidiOutputPortsGrid>:
    row_default_height: app.curr_height * 1/16
    row_force_default: True


<MidiPortLabel>:
    size_hint_x: 7/8
    color: C('#000000FF')
    font_size: self.height * 0.5
    text_size: self.size
    halign: 'left'
    valign: 'middle'
    background_color: C('#00000000')


<MidiInputPortCheckBox>:
    size_hint_x: 1/8
    active: self.port_name in app.connected_midi_input_names_for_gui
    on_active: app.midi_input_port_checkbox_toggled(self.port_name, self.active)


<MidiOutputPortCheckBox>:
    size_hint_x: 1/8
    active: self.port_name in app.connected_midi_output_names_for_gui
    on_active: app.midi_output_port_checkbox_toggled(self.port_name, self.active)


<NymphesPortSpinner@Spinner>:
    color: C('#000000FF')
    font_size: self.height * 0.5
    text_size: self.size
    halign: 'right'
    valign: 'middle'
    background_color: C('#00000000')
    option_cls: 'NymphesPortSpinnerOption'


<NymphesPortSpinnerOption@SpinnerOption>:
    color: C('#000000FF')
    font_size: self.height * 0.5
    text_size: self.size
    halign: 'right'
    valign: 'middle'
    background_color: C('#1D60C5F5')
    background_normal: ''

<NymphesPortSpinnerLabel@Label>:
    color: C('#ECBFEBFF')
    font_size: self.height * 0.4
    text_size: self.size
    halign: 'left'
    valign: 'middle'
    background_color: C('#00000000')


<BottomBar>:
    orientation: 'horizontal'
    padding: [self.corner_radius * 1, self.corner_radius * 0.25]
    spacing: 0

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius, root.corner_radius, root.corner_radius, root.corner_radius]

    Label:
        size_hint_x: 22/40
        text: app.status_bar_text
        color: C('#222754FF')
        font_size: self.height * 0.6
        text_size: self.size
        halign: 'left'
        valign: 'middle'

    # Mod Wheel
    Label:
        size_hint_x: 4/40
        text: 'MOD WHEEL'
        color: C('#ECBFEBFF')
        font_size: self.height * 0.6
        text_size: self.size
        halign: 'right'
        valign: 'middle'
        disabled: not app.nymphes_connected

    ModWheelValueLabel:
        size_hint_x: 2/40
        text_color_string: '#092042FF'

    # Velocity
    Label:
        size_hint_x: 4/40
        text: 'VELOCITY'
        color: C('#ECBFEBFF')
        font_size: self.height * 0.6
        text_size: self.size
        halign: 'right'
        valign: 'middle'
        disabled: not app.nymphes_connected

    Label:
        size_hint_x: 2/40
        text: str(app.velocity)
        color: C('#222754FF') if app.nymphes_connected else C('#ECBFEBFF')
        font_size: self.height * 0.8
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        disabled: not app.nymphes_connected

    # Aftertouch
    Label:
        size_hint_x: 4/40
        text: 'AFTERTOUCH'
        color: C('#ECBFEBFF') if app.nymphes_connected else C('#ECBFEBFF')
        font_size: self.height * 0.6
        text_size: self.size
        halign: 'right'
        valign: 'middle'
        disabled: not app.nymphes_connected

    AftertouchValueLabel:
        size_hint_x: 2/40
        text_color_string: '#092042FF'


<ModWheelValueLabel>:
    color: C(self.text_color_string) if app.nymphes_connected else C('#ECBFEBFF')
    font_size: self.height * 0.8
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    text: str(app.mod_wheel)
    on_touch_down: if self.collide_point(*args[1].pos): self.handle_touch(args[1].device, args[1].button)
    disabled: not app.nymphes_connected

<AftertouchValueLabel>:
    color: C(self.text_color_string) if app.nymphes_connected else C('#ECBFEBFF')
    font_size: self.height * 0.8
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    text: str(app.aftertouch)
    on_touch_down: if self.collide_point(*args[1].pos): self.handle_touch(args[1].device, args[1].button)
    disabled: not app.nymphes_connected


<ChordParamsGrid>:
    cols: 6
    corner_radius: self.width * 0.03
    spacing: self.width * 0.01


<ChordParamsGridCell>:
    orientation: 'vertical'
    corner_radius: self.parent.corner_radius
    #on_press: app.select_section(self.section_name)
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]
    canvas.before:
        Color:
            rgba: C(self.background_color_string)
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [root.corner_radius]

    ParamNameLabel:
        text: root.title

    ChordParamValueLabel:
        text: str(root.value_prop)
        param_name: root.param_name
        text_color_string: root.value_color_string


<ChordParamValueLabel>:
    background_color: 0, 1, 1, 0.7
    color: C(self.text_color_string) if app.nymphes_connected else C('#ECBFEBFF')
    font_size: self.width * 0.35
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    on_press: app.label_clicked(self.param_name)
    on_touch_down: if self.collide_point(*args[1].pos): self.handle_touch(args[1].device, args[1].button)
    disabled: not app.nymphes_connected


<ChordSectionTitleLabel>:
    size_hint_y: None
    height: app.curr_height * 1/16
    background_color: 0, 1, 0, 0.3
    color: C('#ECBFEBFF') if not app.nymphes_connected else (C('#ECBFEBFF') if self.this_chord_active else C('#000000FF'))
    font_size: self.height * 0.6 if self.this_chord_active else self.height * 0.5
    text_size: self.size
    halign: 'left'
    valign: 'middle'
    disabled: not app.nymphes_connected