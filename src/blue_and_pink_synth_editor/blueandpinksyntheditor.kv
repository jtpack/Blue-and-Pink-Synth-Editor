#:kivy 2.1.0
#:import C kivy.utils.get_color_from_hex
#:import SlideTransition kivy.uix.screenmanager.SlideTransition

ScreenManager:
    DashboardScreen
    SettingsScreen
    ChordsScreen


<DashboardScreen@Screen>:
    name: 'dashboard'

    canvas.before:
        Color:
            rgba: C('#092042FF')
        Rectangle:
            pos: self.pos
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: (root.height * 0.008, 0, root.height * 0.008, root.height * 0.008)
        spacing: root.height * 0.008

        # Top Bar
        TopBar:
            screen_name: root.name
            size_hint_y: 3/40
            corner_radius: root.height * 0.015

        MainControlsBox:
            screen_name: root.name
            size_hint_y: 35/40
            corner_radius: root.height * 0.015

        DashboardBottomBar:
            screen_name: root.name
            size_hint_y: 2/40
            corner_radius: root.height * 0.015


<SettingsScreen@Screen>:
    name: 'settings'

    canvas.before:
        Color:
            rgba: C('#092042FF')
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: (app.curr_height * 0.008, 0, app.curr_height * 0.008, app.curr_height * 0.008)
        spacing: app.curr_height * 0.008

        # Top Bar
        SettingsTopBar:
            size_hint_y: 3/40
            corner_radius: root.height * 0.015
            screen_name: root.name

        MainSettingsGrid:
            cols: 3
            spacing: app.curr_height * 0.008
            size_hint_y: 35/40
            corner_radius: root.height * 0.015

            # Row 1
            SettingsSubBox:
                corner_radius: self.parent.corner_radius
                spacing: self.parent.spacing[0]
                orientation: 'vertical'
                size_hint_x: 1/3
                size_hint_y: 4/5

                NymphesPortsSection:
                    size_hint_y: 1/2

                MiscSettingsSection:
                    size_hint_y: 1/2

            MidiInputPortsSection:
                size_hint_x: 1/3
                size_hint_y: 4/5

            MidiOutputPortsSection:
                size_hint_x: 1/3
                size_hint_y: 4/5

        DashboardBottomBar:
            size_hint_y: 2/40
            screen_name: root.name
            corner_radius: root.height * 0.015


<ChordsScreen@Screen>:
    name: 'chords'

    canvas.before:
        Color:
            rgba: C('#092042FF')
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: (root.height * 0.008, 0, root.height * 0.008, root.height * 0.008)
        spacing: root.height * 0.008

        # Top Bar
        ChordsTopBar:
            screen_name: root.name
            size_hint_y: 3/40
            corner_radius: root.height * 0.015

        ChordsMainControlsBox:
            screen_name: root.name
            size_hint_y: 35/40
            corner_radius: root.height * 0.015

        DashboardBottomBar:
            screen_name: root.name
            size_hint_y: 2/40
            corner_radius: root.height * 0.015


<ChordsTopBar>:
    orientation: 'horizontal'
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]
    spacing: self.parent.spacing

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [0, 0, root.corner_radius, root.corner_radius]

    Widget:
        size_hint_x: 18/20

    TopBarButton:
        screen_name: root.screen_name
        size_hint_x: 2/20
        tooltip_text: 'RETURN TO MAIN SCREEN'
        on_release:
            app.root.transition = SlideTransition(direction='right')
            app.root.current = 'dashboard'
            app.set_curr_screen_name('dashboard')
            self.mouse_inside_bounds = False
        text: 'BACK'


<ChordsMainControlsBox>:
    orientation: 'horizontal'
    spacing: self.parent.spacing

    ChordsControlSectionsGrid:
        cols: 2
        spacing: self.parent.spacing
        corner_radius: self.parent.corner_radius

        # Row 1
        Chord0ControlSection:
            screen_name: root.screen_name
            size_hint_y: 1/4

        Chord1ControlSection:
            screen_name: root.screen_name
            size_hint_y: 1/4

        # Row 2
        Chord2ControlSection:
            screen_name: root.screen_name
            size_hint_y: 1/4

        Chord3ControlSection:
            screen_name: root.screen_name
            size_hint_y: 1/4

        # Row 3
        Chord4ControlSection:
            screen_name: root.screen_name
            size_hint_y: 1/4

        Chord5ControlSection:
            screen_name: root.screen_name
            size_hint_y: 1/4

        # Row 4
        Chord6ControlSection:
            screen_name: root.screen_name
            size_hint_y: 1/4

        Chord7ControlSection:
            screen_name: root.screen_name
            size_hint_y: 1/4


<Chord0ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 0 (0-9)'
        this_chord_active: 0 <= app.pitch_chord_value <= 9
        tooltip_text: 'ACTIVATE CHORD 0'
        on_release: app.activate_chord_number(0)


    ChordParamsGrid:

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_0'
            title: 'ROOT'
            param_name: 'chord_0.root'
            value_prop: app.chord_0_root_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_0'
            title: 'SEMI 1'
            param_name: 'chord_0.semi_1'
            value_prop: app.chord_0_semi_1_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_0'
            title: 'SEMI 2'
            param_name: 'chord_0.semi_2'
            value_prop: app.chord_0_semi_2_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_0'
            title: 'SEMI 3'
            param_name: 'chord_0.semi_3'
            value_prop: app.chord_0_semi_3_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_0'
            title: 'SEMI 4'
            param_name: 'chord_0.semi_4'
            value_prop: app.chord_0_semi_4_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_0'
            title: 'SEMI 5'
            param_name: 'chord_0.semi_5'
            value_prop: app.chord_0_semi_5_value
            

<Chord1ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 1 (10-27)'
        this_chord_active: 10 <= app.pitch_chord_value <= 27
        tooltip_text: 'ACTIVATE CHORD 1'
        on_release: app.activate_chord_number(1)

    ChordParamsGrid:

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_1'
            title: 'ROOT'
            param_name: 'chord_1.root'
            value_prop: app.chord_1_root_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_1'
            title: 'SEMI 1'
            param_name: 'chord_1.semi_1'
            value_prop: app.chord_1_semi_1_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_1'
            title: 'SEMI 2'
            param_name: 'chord_1.semi_2'
            value_prop: app.chord_1_semi_2_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_1'
            title: 'SEMI 3'
            param_name: 'chord_1.semi_3'
            value_prop: app.chord_1_semi_3_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_1'
            title: 'SEMI 4'
            param_name: 'chord_1.semi_4'
            value_prop: app.chord_1_semi_4_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_1'
            title: 'SEMI 5'
            param_name: 'chord_1.semi_5'
            value_prop: app.chord_1_semi_5_value


<Chord2ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 2 (28-45)'
        this_chord_active: 28 <= app.pitch_chord_value <= 45
        tooltip_text: 'ACTIVATE CHORD 2'
        on_release: app.activate_chord_number(2)

    ChordParamsGrid:

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_2'
            title: 'ROOT'
            param_name: 'chord_2.root'
            value_prop: app.chord_2_root_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_2'
            title: 'SEMI 1'
            param_name: 'chord_2.semi_1'
            value_prop: app.chord_2_semi_1_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_2'
            title: 'SEMI 2'
            param_name: 'chord_2.semi_2'
            value_prop: app.chord_2_semi_2_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_2'
            title: 'SEMI 3'
            param_name: 'chord_2.semi_3'
            value_prop: app.chord_2_semi_3_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_2'
            title: 'SEMI 4'
            param_name: 'chord_2.semi_4'
            value_prop: app.chord_2_semi_4_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_2'
            title: 'SEMI 5'
            param_name: 'chord_2.semi_5'
            value_prop: app.chord_2_semi_5_value


<Chord3ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 3 (46-63)'
        this_chord_active: 46 <= app.pitch_chord_value <= 63
        tooltip_text: 'ACTIVATE CHORD 3'
        on_release: app.activate_chord_number(3)

    ChordParamsGrid:

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_3'
            title: 'ROOT'
            param_name: 'chord_3.root'
            value_prop: app.chord_3_root_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_3'
            title: 'SEMI 1'
            param_name: 'chord_3.semi_1'
            background_color_string:
            value_prop: app.chord_3_semi_1_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_3'
            title: 'SEMI 2'
            param_name: 'chord_3.semi_2'
            value_prop: app.chord_3_semi_2_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_3'
            title: 'SEMI 3'
            param_name: 'chord_3.semi_3'
            value_prop: app.chord_3_semi_3_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_3'
            title: 'SEMI 4'
            param_name: 'chord_3.semi_4'
            value_prop: app.chord_3_semi_4_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_3'
            title: 'SEMI 5'
            param_name: 'chord_3.semi_5'
            value_prop: app.chord_3_semi_5_value
          
          
<Chord4ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 4 (64-81)'
        this_chord_active: 64 <= app.pitch_chord_value <= 81
        tooltip_text: 'ACTIVATE CHORD 4'
        on_release: app.activate_chord_number(4)

    ChordParamsGrid:

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_4'
            title: 'ROOT'
            param_name: 'chord_4.root'
            value_prop: app.chord_4_root_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_4'
            title: 'SEMI 1'
            param_name: 'chord_4.semi_1'
            value_prop: app.chord_4_semi_1_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_4'
            title: 'SEMI 2'
            param_name: 'chord_4.semi_2'
            value_prop: app.chord_4_semi_2_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_4'
            title: 'SEMI 3'
            param_name: 'chord_4.semi_3'
            value_prop: app.chord_4_semi_3_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_4'
            title: 'SEMI 4'
            param_name: 'chord_4.semi_4'
            value_prop: app.chord_4_semi_4_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_4'
            title: 'SEMI 5'
            param_name: 'chord_4.semi_5'
            value_prop: app.chord_4_semi_5_value


<Chord5ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 5 (82-99)'
        this_chord_active: 82 <= app.pitch_chord_value <= 99
        tooltip_text: 'ACTIVATE CHORD 5'
        on_release: app.activate_chord_number(5)

    ChordParamsGrid:

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_5'
            title: 'ROOT'
            param_name: 'chord_5.root'
            value_prop: app.chord_5_root_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_5'
            title: 'SEMI 1'
            param_name: 'chord_5.semi_1'
            value_prop: app.chord_5_semi_1_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_5'
            title: 'SEMI 2'
            param_name: 'chord_5.semi_2'
            value_prop: app.chord_5_semi_2_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_5'
            title: 'SEMI 3'
            param_name: 'chord_5.semi_3'
            value_prop: app.chord_5_semi_3_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_5'
            title: 'SEMI 4'
            param_name: 'chord_5.semi_4'
            value_prop: app.chord_5_semi_4_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_5'
            title: 'SEMI 5'
            param_name: 'chord_5.semi_5'
            value_prop: app.chord_5_semi_5_value


<Chord6ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 6 (100-117)'
        this_chord_active: 100 <= app.pitch_chord_value <= 117
        tooltip_text: 'ACTIVATE CHORD 6'
        on_release: app.activate_chord_number(6)

    ChordParamsGrid:

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_6'
            title: 'ROOT'
            param_name: 'chord_6.root'
            value_prop: app.chord_6_root_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_6'
            title: 'SEMI 1'
            param_name: 'chord_6.semi_1'
            value_prop: app.chord_6_semi_1_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_6'
            title: 'SEMI 2'
            param_name: 'chord_6.semi_2'
            value_prop: app.chord_6_semi_2_value
            
        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_6'
            title: 'SEMI 3'
            param_name: 'chord_6.semi_3'
            value_prop: app.chord_6_semi_3_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_6'
            title: 'SEMI 4'
            param_name: 'chord_6.semi_4'
            value_prop: app.chord_6_semi_4_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_6'
            title: 'SEMI 5'
            param_name: 'chord_6.semi_5'
            value_prop: app.chord_6_semi_5_value


<Chord7ControlSection@ControlSection>:
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordSectionTitleLabel:
        text: 'CHORD 7 (118-127)'
        this_chord_active: 118 <= app.pitch_chord_value <= 127
        tooltip_text: 'ACTIVATE CHORD 7'
        on_release: app.activate_chord_number(7)

    ChordParamsGrid:

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_7'
            title: 'ROOT'
            param_name: 'chord_7.root'
            value_prop: app.chord_7_root_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_7'
            title: 'SEMI 1'
            param_name: 'chord_7.semi_1'
            value_prop: app.chord_7_semi_1_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_7'
            title: 'SEMI 2'
            param_name: 'chord_7.semi_2'
            value_prop: app.chord_7_semi_2_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_7'
            title: 'SEMI 3'
            param_name: 'chord_7.semi_3'
            value_prop: app.chord_7_semi_3_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_7'
            title: 'SEMI 4'
            param_name: 'chord_7.semi_4'
            value_prop: app.chord_7_semi_4_value

        ChordParamsGridCell:
            screen_name: root.screen_name
            section_name: 'chord_7'
            title: 'SEMI 5'
            param_name: 'chord_7.semi_5'
            value_prop: app.chord_7_semi_5_value


<SettingsTopBar>:
    orientation: 'horizontal'
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]
    spacing: self.parent.spacing

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [0, 0, root.corner_radius, root.corner_radius]

    Widget:
        size_hint_x: 18/20

    TopBarButton:
        screen_name: root.screen_name
        tooltip_text: 'RETURN TO MAIN SCREEN'
        on_release:
            app.root.transition = SlideTransition(direction='right')
            app.root.current = 'dashboard'
            app.set_curr_screen_name('dashboard')
            self.mouse_inside_bounds = False
        text: 'BACK'
        size_hint_x: 2/20

<TopBar>:
    orientation: 'horizontal'
    padding: [self.corner_radius * 0, self.corner_radius * 0]
    spacing: self.parent.spacing

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [0, 0, root.corner_radius, root.corner_radius]

    PresetIncButton:
        screen_name: root.screen_name
        tooltip_text: 'RECALL PREVIOUS PRESET'
        size_hint_x: 1/20
        text: '-'
        base_font_size: self.height * 1.2
        on_release: app.load_prev_preset()

    TopBarSpinner:
        size_hint_x: 7/20
        values: app.presets_spinner_values
        text: app.presets_spinner_text
        on_text: app.presets_spinner_text_changed(self.values.index(self.text), self.text)
        screen_name: root.screen_name
        tooltip_text: 'SELECT A PRESET'

    PresetIncButton:
        screen_name: root.screen_name
        tooltip_text: 'RECALL NEXT PRESET'
        size_hint_x: 1/20
        text: '+'
        on_release: app.load_next_preset()

    TopBarButton:
        screen_name: root.screen_name
        tooltip_text: 'SAVE CURRENT CHANGES TO ' + app.presets_spinner_text
        size_hint_x: 2/20
        text: 'SAVE'
        on_release: app.update_current_preset()
        disabled: not app.nymphes_connected or app.unsaved_preset_changes == False

    TopBarButton:
        screen_name: root.screen_name
        tooltip_text: 'DISCARD CHANGES AND RELOAD ' + app.presets_spinner_text
        size_hint_x: 2/20
        text: 'REVERT'
        on_release: app.reload()
        disabled: not app.nymphes_connected or app.curr_preset_type == '' or app.unsaved_preset_changes == False

    Widget:
        size_hint_x: 1/20

    TopBarButton:
        screen_name: root.screen_name
        size_hint_x: 2/20
        text: 'OPEN'
        tooltip_text: 'LOAD PRESET FILE'
        on_release: app.show_load_dialog()
        disabled: not app.nymphes_connected

    TopBarButton:
        screen_name: root.screen_name
        size_hint_x: 2/20
        text: 'SAVE AS'
        tooltip_text: 'SAVE TO NEW PRESET FILE'
        on_release: app.show_save_dialog()
        disabled: not app.nymphes_connected

    Widget:
        size_hint_x: 1/20

    TopBarButton:
        screen_name: root.screen_name
        size_hint_x: 3/20
        tooltip_text: 'SHOW SETTINGS SCREEN'
        on_release:
            app.root.transition = SlideTransition(direction='left')
            app.root.current = 'settings'
            app.set_curr_screen_name('settings')
            self.mouse_inside_bounds = False
        text: 'SETTINGS'


<MainControlsBox>:
    orientation: 'horizontal'
    spacing: self.parent.spacing

#    canvas.before:
#        Color:
#            rgba: C('#0000FFFF')
#        Rectangle:
#            pos: self.pos
#            size: self.size

    LeftBar:
        size_hint: 1/12, 1
        screen_name: root.screen_name

    ControlSectionsGrid:
        cols: 2
        spacing: self.parent.spacing
        corner_radius: self.parent.corner_radius

#        canvas.before:
#            Color:
#                rgba: C('#00FFFFFF')
#            Rectangle:
#                pos: self.pos
#                size: self.size

        # Top Row
        OscillatorControlSection:
            screen_name: root.screen_name
            size_hint_y: 2/4

        FilterControlSection:
            screen_name: root.screen_name
            size_hint_y: 2/4

        # Middle Row
        AmpControlSection:
            screen_name: root.screen_name
            size_hint_y: 1/4

        Lfo1ControlSection:
            screen_name: root.screen_name
            size_hint_y: 1/5

        # Bottom Row
        ReverbControlSection:
            screen_name: root.screen_name
            size_hint_y: 1/4

        Lfo2ControlSection:
            screen_name: root.screen_name
            size_hint_y: 1/4


<LeftBar>:
    orientation: 'vertical'
    id: left_bar
    corner_radius: self.parent.corner_radius
    spacing: self.parent.spacing

#    canvas.before:
#        Color:
#            rgba: C('#F000F0FF')
#        Rectangle:
#            pos: self.pos
#            size: self.size

    # Voice Mode Box
    VoiceModeBox:
        screen_name: root.screen_name
        size_hint: 1, 19/28
        corner_radius: root.corner_radius

    LegatoBox:
        size_hint: 1, 3/28
        corner_radius: root.corner_radius
        screen_name: root.screen_name

    ChordsButtonBox:
        size_hint: 1, 3/28
        corner_radius: root.corner_radius
        screen_name: root.screen_name

    FineModeBox:
        size_hint: 1, 3/28
        corner_radius: root.corner_radius
        screen_name: root.screen_name


<VoiceModeBox>:
    orientation: 'vertical'
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]
    spacing: self.height * 1/50

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    VoiceModeButton:
        voice_mode_name: 'POLY'
        screen_name: root.screen_name
        tooltip_text: 'POLY MODE (6 NOTES, 1 VOICE PER NOTE)'

    VoiceModeButton:
        voice_mode_name: 'UNI-A'
        screen_name: root.screen_name
        tooltip_text: 'UNISON-A MODE (1 NOTE, 6 VOICES PER NOTE)'

    VoiceModeButton:
        voice_mode_name: 'UNI-B'
        screen_name: root.screen_name
        tooltip_text: 'UNISON-B MODE (1 NOTE, 4 VOICES PER NOTE)'

    VoiceModeButton:
        voice_mode_name: 'TRI'
        screen_name: root.screen_name
        tooltip_text: 'TRI MODE (3 NOTES, 2 VOICES PER NOTE)'

    VoiceModeButton:
        voice_mode_name: 'DUO'
        screen_name: root.screen_name
        tooltip_text: 'DUO MODE (2 NOTES, 3 VOICES PER NOTE)'

    VoiceModeButton:
        voice_mode_name: 'MONO'
        screen_name: root.screen_name
        tooltip_text: 'MONO MODE (1 NOTE, 1 VOICE PER NOTE)'

<VoiceModeButton>:
    text: self.voice_mode_name
    color: C('#ECBFEBFF') if app.voice_mode_name == self.voice_mode_name or self.mouse_pressed else C('#06070FFF')
    base_font_size: self.height * 0.375
    on_release: app.set_voice_mode_by_name(self.voice_mode_name)
    disabled: not app.nymphes_connected


<LegatoBox>:
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    LegatoButton:
        screen_name: root.screen_name

<LegatoButton@HoverButton>:
    text: 'LEGATO'
    size_hint: 1, 1
    base_font_size: self.height * 0.35
    color: C('#ECBFEBFF') if app.osc_legato_value == 127 or self.mouse_pressed else C('#06070FFF')
    on_release: app.set_legato(127 if app.osc_legato_value == 0 else 0)
    disabled: not app.nymphes_connected
    tooltip_text: 'LEGATO MODE'


<ChordsButtonBox>:
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    ChordsButton:
        screen_name: root.screen_name

<ChordsButton@HoverButton>:
    text: 'CHORDS'
    color: C('#ECBFEBFF') if self.mouse_pressed else C('#06070FFF')
    base_font_size: self.height * 0.35
    on_release:
        app.root.transition = SlideTransition(direction='left')
        app.root.current = 'chords'
        app.set_curr_screen_name('chords')
        self.mouse_inside_bounds = False
    disabled: not app.nymphes_connected
    tooltip_text: 'SHOW CHORDS EDITOR'

<FineModeBox>:
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    FineModeButton:
        screen_name: root.screen_name

<FineModeButton@HoverButton>:
    text: 'FINE MODE'
    size_hint: 1, 1
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    color: C('#ECBFEBFF') if app.fine_mode and not self.disabled or self.mouse_pressed else C('#06070FFF')
    base_font_size: self.height * 0.35
    on_release: app.set_fine_mode(not app.fine_mode)
    disabled: not app.nymphes_connected
    tooltip_text: 'HIGH RESOLUTION CONTROL (0.1 INCREMENT INSTEAD OF 1.0)'

<ControlSection>:
    orientation: 'vertical'
    corner_radius: self.parent.corner_radius
    padding: [self.corner_radius * 0.5, 0, self.corner_radius * 0.5, self.corner_radius * 0.5]

<SectionTitleLabel>:
    size_hint_y: None
    height: app.curr_height * 1/16
    background_color: 0, 1, 0, 0.3
    color: C('#06070FFF') if app.nymphes_connected else C('#ECBFEBFF')
    font_size: self.height * 0.5
    text_size: self.size
    halign: 'left'
    valign: 'middle'
    disabled: not app.nymphes_connected


<ParamNameLabel>:
    background_color: 1, 1, 0, 0.7
    color: C(self.text_color_string) if app.nymphes_connected else C('#ECBFEBFF')
    font_size: self.width * 0.3
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    disabled: not app.nymphes_connected


#<ValueControl>:
#    #background_color: 0, 1, 1, 0.7
#    color: C('#EDC0ECFF') if self.mouse_pressed else C(self.text_color_string) if app.nymphes_connected else C('#ECBFEBFF')
#    base_font_size: self.width * 0.35
#    font_size: (self.base_font_size * 1.08) if self.mouse_inside_bounds else self.base_font_size
#    text_size: self.size
#    halign: 'center'
#    valign: 'middle'
#    #on_touch_down: if self.collide_point(*args[1].pos): self.handle_touch(args[1].device, args[1].button)
#    disabled: not app.nymphes_connected


<OscillatorControlSection@ControlSection>:
    param_name_color_string: '#ECBFEBFF'
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    SectionTitleLabel:
        text: 'OSCILLATOR'

    ParamsGrid:
        # Top Row
        #
        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'oscillator_top_row'
            title: 'PW'
            param_name: 'osc.pulsewidth'
            param_name_color_string: root.param_name_color_string
            value_prop: app.osc_pulsewidth_value
            lfo2_prop: app.osc_pulsewidth_lfo2
            mod_wheel_prop: app.osc_pulsewidth_mod_wheel
            velocity_prop: app.osc_pulsewidth_velocity
            aftertouch_prop: app.osc_pulsewidth_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'oscillator_top_row'
            title: 'GLD'
            param_name: 'pitch.glide'
            param_name_color_string: root.param_name_color_string
            value_prop: app.pitch_glide_value
            lfo2_prop: app.pitch_glide_lfo2
            mod_wheel_prop: app.pitch_glide_mod_wheel
            velocity_prop: app.pitch_glide_velocity
            aftertouch_prop: app.pitch_glide_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'oscillator_top_row'
            title: 'DTN'
            param_name: 'pitch.detune'
            param_name_color_string: root.param_name_color_string
            value_prop: app.pitch_detune_value
            lfo2_prop: app.pitch_detune_lfo2
            mod_wheel_prop: app.pitch_detune_mod_wheel
            velocity_prop: app.pitch_detune_velocity
            aftertouch_prop: app.pitch_detune_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'oscillator_top_row'
            title: 'CHD'
            param_name: 'pitch.chord'
            param_name_color_string: root.param_name_color_string
            value_prop: app.pitch_chord_value
            lfo2_prop: app.pitch_chord_lfo2
            mod_wheel_prop: app.pitch_chord_mod_wheel
            velocity_prop: app.pitch_chord_velocity
            aftertouch_prop: app.pitch_chord_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'oscillator_top_row'
            title: 'EG'
            param_name: 'pitch.eg'
            param_name_color_string: '#0010EEFF'
            value_prop: app.pitch_eg_value
            lfo2_prop: app.pitch_eg_lfo2
            mod_wheel_prop: app.pitch_eg_mod_wheel
            velocity_prop: app.pitch_eg_velocity
            aftertouch_prop: app.pitch_eg_aftertouch

        # Bottom Row
        #
        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'oscillator_bottom_row'
            title: 'WAVE'
            param_name: 'osc.wave'
            param_name_color_string: root.param_name_color_string
            value_prop: app.osc_wave_value
            lfo2_prop: app.osc_wave_lfo2
            mod_wheel_prop: app.osc_wave_mod_wheel
            velocity_prop: app.osc_wave_velocity
            aftertouch_prop: app.osc_wave_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'oscillator_bottom_row'
            title: 'LVL'
            param_name: 'mix.osc'
            param_name_color_string: root.param_name_color_string
            value_prop: app.mix_osc_value
            lfo2_prop: app.mix_osc_lfo2
            mod_wheel_prop: app.mix_osc_mod_wheel
            velocity_prop: app.mix_osc_velocity
            aftertouch_prop: app.mix_osc_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'oscillator_bottom_row'
            title: 'SUB'
            param_name: 'mix.sub'
            param_name_color_string: root.param_name_color_string
            value_prop: app.mix_sub_value
            lfo2_prop: app.mix_sub_lfo2
            mod_wheel_prop: app.mix_sub_mod_wheel
            velocity_prop: app.mix_sub_velocity
            aftertouch_prop: app.mix_sub_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'oscillator_bottom_row'
            title: 'NOISE'
            param_name: 'mix.noise'
            param_name_color_string: root.param_name_color_string
            value_prop: app.mix_noise_value
            lfo2_prop: app.mix_noise_lfo2
            mod_wheel_prop: app.mix_noise_mod_wheel
            velocity_prop: app.mix_noise_velocity
            aftertouch_prop: app.mix_noise_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'oscillator_bottom_row'
            title: 'LFO1'
            param_name_color_string: root.param_name_color_string
            param_name: 'pitch.lfo1'
            value_prop: app.pitch_lfo1_value
            lfo2_prop: app.pitch_lfo1_lfo2
            mod_wheel_prop: app.pitch_lfo1_mod_wheel
            velocity_prop: app.pitch_lfo1_velocity
            aftertouch_prop: app.pitch_lfo1_aftertouch

<FilterControlSection@ControlSection>:
    param_name_color_string: '#ECBFEBFF'
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    SectionTitleLabel:
        text: 'FILTER'

    ParamsGrid:
        # Top Row
        #
        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'filter_top_row'
            title: 'CUT'
            param_name: 'lpf.cutoff'
            param_name_color_string: root.param_name_color_string
            value_prop: app.lpf_cutoff_value
            lfo2_prop: app.lpf_cutoff_lfo2
            mod_wheel_prop: app.lpf_cutoff_mod_wheel
            velocity_prop: app.lpf_cutoff_velocity
            aftertouch_prop: app.lpf_cutoff_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'filter_top_row'
            title: 'RES'
            param_name: 'lpf.resonance'
            param_name_color_string: root.param_name_color_string
            value_prop: app.lpf_resonance_value
            lfo2_prop: app.lpf_resonance_lfo2
            mod_wheel_prop: app.lpf_resonance_mod_wheel
            velocity_prop: app.lpf_resonance_velocity
            aftertouch_prop: app.lpf_resonance_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'filter_top_row'
            title: 'TRK'
            param_name: 'lpf.tracking'
            param_name_color_string: root.param_name_color_string
            value_prop: app.lpf_tracking_value
            lfo2_prop: app.lpf_tracking_lfo2
            mod_wheel_prop: app.lpf_tracking_mod_wheel
            velocity_prop: app.lpf_tracking_velocity
            aftertouch_prop: app.lpf_tracking_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'filter_top_row'
            title: 'EG'
            param_name: 'lpf.eg'
            param_name_color_string: '#0010EEFF'
            value_prop: app.lpf_eg_value
            lfo2_prop: app.lpf_eg_lfo2
            mod_wheel_prop: app.lpf_eg_mod_wheel
            velocity_prop: app.lpf_eg_velocity
            aftertouch_prop: app.lpf_eg_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'filter_top_row'
            title: 'LFO1'
            param_name_color_string: root.param_name_color_string
            param_name: 'lpf.lfo1'
            value_prop: app.lpf_lfo1_value
            lfo2_prop: app.lpf_lfo1_lfo2
            mod_wheel_prop: app.lpf_lfo1_mod_wheel
            velocity_prop: app.lpf_lfo1_velocity
            aftertouch_prop: app.lpf_lfo1_aftertouch

        # Bottom Row
        #
        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'filter_bottom_row'
            title: 'ATT'
            param_name: 'filter_eg.attack'
            param_name_color_string: '#0010EEFF'
            value_prop: app.filter_eg_attack_value
            lfo2_prop: app.filter_eg_attack_lfo2
            mod_wheel_prop: app.filter_eg_attack_mod_wheel
            velocity_prop: app.filter_eg_attack_velocity
            aftertouch_prop: app.filter_eg_attack_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'filter_bottom_row'
            title: 'DEC'
            param_name: 'filter_eg.decay'
            param_name_color_string: '#0010EEFF'
            value_prop: app.filter_eg_decay_value
            lfo2_prop: app.filter_eg_decay_lfo2
            mod_wheel_prop: app.filter_eg_decay_mod_wheel
            velocity_prop: app.filter_eg_decay_velocity
            aftertouch_prop: app.filter_eg_decay_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'filter_bottom_row'
            title: 'SUS'
            param_name: 'filter_eg.sustain'
            param_name_color_string: '#0010EEFF'
            value_prop: app.filter_eg_sustain_value
            lfo2_prop: app.filter_eg_sustain_lfo2
            mod_wheel_prop: app.filter_eg_sustain_mod_wheel
            velocity_prop: app.filter_eg_sustain_velocity
            aftertouch_prop: app.filter_eg_sustain_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'filter_bottom_row'
            title: 'REL'
            param_name: 'filter_eg.release'
            param_name_color_string: '#0010EEFF'
            value_prop: app.filter_eg_release_value
            lfo2_prop: app.filter_eg_release_lfo2
            mod_wheel_prop: app.filter_eg_release_mod_wheel
            velocity_prop: app.filter_eg_release_velocity
            aftertouch_prop: app.filter_eg_release_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'filter_bottom_row'
            title: 'HPF'
            param_name: 'hpf.cutoff'
            param_name_color_string: root.param_name_color_string
            value_prop: app.hpf_cutoff_value
            lfo2_prop: app.hpf_cutoff_lfo2
            mod_wheel_prop: app.hpf_cutoff_mod_wheel
            velocity_prop: app.hpf_cutoff_velocity
            aftertouch_prop: app.hpf_cutoff_aftertouch

<Lfo1ControlSection@ControlSection>:
    param_name_color_string: '#5500EEFF'
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    SectionTitleLabel:
        text: 'LFO1'

    ParamsGrid:
        # Top Row
        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'lfo1'
            title: 'RATE'
            param_name: 'lfo1.rate'
            param_name_color_string: root.param_name_color_string
            value_prop: app.lfo1_rate_value
            lfo2_prop: app.lfo1_rate_lfo2
            mod_wheel_prop: app.lfo1_rate_mod_wheel
            velocity_prop: app.lfo1_rate_velocity
            aftertouch_prop: app.lfo1_rate_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'lfo1'
            title: 'WAVE'
            param_name: 'lfo1.wave'
            param_name_color_string: root.param_name_color_string
            value_prop: app.lfo1_wave_value
            lfo2_prop: app.lfo1_wave_lfo2
            mod_wheel_prop: app.lfo1_wave_mod_wheel
            velocity_prop: app.lfo1_wave_velocity
            aftertouch_prop: app.lfo1_wave_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'lfo1'
            title: 'DEL'
            param_name: 'lfo1.delay'
            param_name_color_string: root.param_name_color_string
            value_prop: app.lfo1_delay_value
            lfo2_prop: app.lfo1_delay_lfo2
            mod_wheel_prop: app.lfo1_delay_mod_wheel
            velocity_prop: app.lfo1_delay_velocity
            aftertouch_prop: app.lfo1_delay_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'lfo1'
            title: 'FADE'
            param_name: 'lfo1.fade'
            param_name_color_string: root.param_name_color_string
            value_prop: app.lfo1_fade_value
            lfo2_prop: app.lfo1_fade_lfo2
            mod_wheel_prop: app.lfo1_fade_mod_wheel
            velocity_prop: app.lfo1_fade_velocity
            aftertouch_prop: app.lfo1_fade_aftertouch

        ParamsGridLfoConfigCell:
            screen_name: root.screen_name
            section_name: 'lfo1'
            param_name_color_string: root.param_name_color_string
            type_prop: app.lfo1_type_value
            key_sync_prop: app.lfo1_key_sync_value


<AmpControlSection@ControlSection>:
    param_name_color_string: '#ECBFEBFF'
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    SectionTitleLabel:
        text: 'AMP'

    ParamsGrid:
        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'amp'
            title: 'ATT'
            param_name: 'amp_eg.attack'
            param_name_color_string: root.param_name_color_string
            value_prop: app.amp_eg_attack_value
            lfo2_prop: app.amp_eg_attack_lfo2
            mod_wheel_prop: app.amp_eg_attack_mod_wheel
            velocity_prop: app.amp_eg_attack_velocity
            aftertouch_prop: app.amp_eg_attack_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'amp'
            title: 'DEC'
            param_name: 'amp_eg.decay'
            param_name_color_string: root.param_name_color_string
            value_prop: app.amp_eg_decay_value
            lfo2_prop: app.amp_eg_decay_lfo2
            mod_wheel_prop: app.amp_eg_decay_mod_wheel
            velocity_prop: app.amp_eg_decay_velocity
            aftertouch_prop: app.amp_eg_decay_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'amp'
            title: 'SUS'
            param_name: 'amp_eg.sustain'
            param_name_color_string: root.param_name_color_string
            value_prop: app.amp_eg_sustain_value
            lfo2_prop: app.amp_eg_sustain_lfo2
            mod_wheel_prop: app.amp_eg_sustain_mod_wheel
            velocity_prop: app.amp_eg_sustain_velocity
            aftertouch_prop: app.amp_eg_sustain_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'amp'
            title: 'REL'
            param_name: 'amp_eg.release'
            param_name_color_string: root.param_name_color_string
            value_prop: app.amp_eg_release_value
            lfo2_prop: app.amp_eg_release_lfo2
            mod_wheel_prop: app.amp_eg_release_mod_wheel
            velocity_prop: app.amp_eg_release_velocity
            aftertouch_prop: app.amp_eg_release_aftertouch

        ParamsGridNonModCell:
            screen_name: root.screen_name
            section_name: 'amp'
            title: 'LVL'
            param_name: 'mix.level'
            param_name_color_string: root.param_name_color_string
            value_prop: app.mix_level_value


<ReverbControlSection@ControlSection>:
    param_name_color_string: '#ECBFEBFF'
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    SectionTitleLabel:
        text: 'REVERB'

    ParamsGrid:
        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'reverb'
            title: 'SIZE'
            param_name: 'reverb.size'
            param_name_color_string: root.param_name_color_string
            value_prop: app.reverb_size_value
            lfo2_prop: app.reverb_size_lfo2
            mod_wheel_prop: app.reverb_size_mod_wheel
            velocity_prop: app.reverb_size_velocity
            aftertouch_prop: app.reverb_size_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'reverb'
            title: 'DEC'
            param_name: 'reverb.decay'
            param_name_color_string: root.param_name_color_string
            value_prop: app.reverb_decay_value
            lfo2_prop: app.reverb_decay_lfo2
            mod_wheel_prop: app.reverb_decay_mod_wheel
            velocity_prop: app.reverb_decay_velocity
            aftertouch_prop: app.reverb_decay_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'reverb'
            title: 'FILT'
            param_name: 'reverb.filter'
            param_name_color_string: root.param_name_color_string
            value_prop: app.reverb_filter_value
            lfo2_prop: app.reverb_filter_lfo2
            mod_wheel_prop: app.reverb_filter_mod_wheel
            velocity_prop: app.reverb_filter_velocity
            aftertouch_prop: app.reverb_filter_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'reverb'
            title: 'MIX'
            param_name: 'reverb.mix'
            param_name_color_string: root.param_name_color_string
            value_prop: app.reverb_mix_value
            lfo2_prop: app.reverb_mix_lfo2
            mod_wheel_prop: app.reverb_mix_mod_wheel
            velocity_prop: app.reverb_mix_velocity
            aftertouch_prop: app.reverb_mix_aftertouch

        Widget:
            size_hint: 1, 1

<Lfo2ControlSection@ControlSection>:
    param_name_color_string: '#ECBFEBFF'
    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    SectionTitleLabel:
        text: 'LFO2'

    ParamsGrid:
        # Top Row
        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'lfo2'
            title: 'RATE'
            param_name: 'lfo2.rate'
            param_name_color_string: root.param_name_color_string
            value_prop: app.lfo2_rate_value
            lfo2_prop: app.lfo2_rate_lfo2
            mod_wheel_prop: app.lfo2_rate_mod_wheel
            velocity_prop: app.lfo2_rate_velocity
            aftertouch_prop: app.lfo2_rate_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'lfo2'
            title: 'WAVE'
            param_name: 'lfo2.wave'
            param_name_color_string: root.param_name_color_string
            value_prop: app.lfo2_wave_value
            lfo2_prop: app.lfo2_wave_lfo2
            mod_wheel_prop: app.lfo2_wave_mod_wheel
            velocity_prop: app.lfo2_wave_velocity
            aftertouch_prop: app.lfo2_wave_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'lfo2'
            title: 'DEL'
            param_name: 'lfo2.delay'
            param_name_color_string: root.param_name_color_string
            value_prop: app.lfo2_delay_value
            lfo2_prop: app.lfo2_delay_lfo2
            mod_wheel_prop: app.lfo2_delay_mod_wheel
            velocity_prop: app.lfo2_delay_velocity
            aftertouch_prop: app.lfo2_delay_aftertouch

        ParamsGridModCell:
            screen_name: root.screen_name
            section_name: 'lfo2'
            title: 'FADE'
            param_name: 'lfo2.fade'
            param_name_color_string: root.param_name_color_string
            value_prop: app.lfo2_fade_value
            lfo2_prop: app.lfo2_fade_lfo2
            mod_wheel_prop: app.lfo2_fade_mod_wheel
            velocity_prop: app.lfo2_fade_velocity
            aftertouch_prop: app.lfo2_fade_aftertouch

        ParamsGridLfoConfigCell:
            screen_name: root.screen_name
            section_name: 'lfo2'
            param_name_color_string: root.param_name_color_string
            type_prop: app.lfo2_type_value
            key_sync_prop: app.lfo2_key_sync_value

<ParamsGrid>:
    cols: 5
    corner_radius: self.width * 0.03
    spacing: self.width * 0.01


<ParamsGridModCell>:
    value_color_string: '#06070FFF'
    background_color_string: '#438EFFFF'
    mod_amount_line_background_color_string: '#6AA3F8FF'
    orientation: 'vertical'
    corner_radius: self.parent.corner_radius
    padding: [self.corner_radius * 0.25]
    canvas.before:
        Color:
            rgba: C(self.background_color_string)
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [root.corner_radius]

    ParamNameLabel:
        text: root.title
        text_color_string: root.param_name_color_string

    FloatValueControl:
        screen_name: root.screen_name
        section_name: root.section_name
        param_name: root.param_name + '.value'
        text_color_string: root.value_color_string
        float_value_decimal_places: app.fine_mode_decimal_places
        enable_float_value: True
        enable_float_drag: app.fine_mode
        fine_mode: app.fine_mode
        invert_mouse_wheel: app.invert_mouse_wheel
        external_value: root.value_prop
        value_changed_callback: (lambda val: app.set_prop_value_for_param_name(self.param_name, self.value))
        size_hint_y: None
        height: app.curr_height * 1/16

    ModAmountsBox:
        mod_amount_line_background_color_string: root.mod_amount_line_background_color_string
        size_hint_x: 0.75
        pos_hint: {'center_x': 0.5}
        screen_name: root.screen_name
        param_name: root.param_name
        lfo2_prop: root.lfo2_prop
        mod_wheel_prop: root.mod_wheel_prop
        velocity_prop: root.velocity_prop
        aftertouch_prop: root.aftertouch_prop


<ModAmountsBox>:
    orientation: 'horizontal'
    spacing: self.height * 0.1
    size_hint: 1, 1

    Lfo2ModAmountLine:
        background_color_string: root.mod_amount_line_background_color_string
        param_name: root.param_name
        screen_name: root.screen_name
        mod_type: 'lfo2'
        midi_val: root.lfo2_prop

    WheelModAmountLine:
        background_color_string: root.mod_amount_line_background_color_string
        param_name: root.param_name
        screen_name: root.screen_name
        mod_type: 'mod_wheel'
        midi_val: root.mod_wheel_prop

    VelocityModAmountLine:
        background_color_string: root.mod_amount_line_background_color_string
        param_name: root.param_name
        screen_name: root.screen_name
        mod_type: 'velocity'
        midi_val: root.velocity_prop

    AftertouchModAmountLine:
        background_color_string: root.mod_amount_line_background_color_string
        param_name: root.param_name
        screen_name: root.screen_name
        mod_type: 'aftertouch'
        midi_val: root.aftertouch_prop


<ModAmountLine>:
    fine_mode_decimal_places: app.fine_mode_decimal_places
    canvas:
        # Line Background

        Color:
            rgba: C(self.background_color_string)

        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [self.width * 0.5]

        # Line Which Grows with the Value
        Color:
            rgba: C(root.color_hex) if root.midi_val > 0 else C('#00000000')

        RoundedRectangle:
            pos: self.pos
            size: self.size[0], (root.midi_val / 127.0) * (root.height - root.height * 0.01)
            radius: [self.width * 0.5]

    on_touch_down: if self.collide_point(*args[1].pos): self.handle_touch(args[1].device, args[1].button)
    disabled: not app.nymphes_connected


<Lfo2ModAmountLine@ModAmountLine>:
    color_hex: '#F41513FF'


<WheelModAmountLine@ModAmountLine>:
    color_hex: '#FDFF00FF'


<VelocityModAmountLine@ModAmountLine>:
    color_hex: '#00FF1FFF'


<AftertouchModAmountLine@ModAmountLine>:
    color_hex: '#AA00FFFF'


<ParamsGridLfoConfigCell>:
    background_color_string: '#438EFFFF'
    orientation: 'vertical'
    corner_radius: self.parent.corner_radius
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]
    canvas.before:
        Color:
            rgba: C(self.background_color_string)
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [root.corner_radius]

    ParamNameLabel:
        font_size: self.width * 0.2
        text: 'TYPE'
        text_color_string: root.param_name_color_string

    LfoTypeValueControl:
        screen_name: root.screen_name
        section_name: root.section_name
        param_name: root.section_name + '.type.value'
        external_value: root.type_prop
        value_changed_callback: (lambda val: app.set_prop_value_for_param_name(self.param_name, self.value))
        invert_mouse_wheel: app.invert_mouse_wheel
        text_color_string: root.value_color_string

    ParamNameLabel:
        font_size: self.width * 0.2
        text: 'SYNC'
        text_color_string: root.param_name_color_string

    LfoSyncValueControl:
        screen_name: root.screen_name
        section_name: root.section_name
        param_name: root.section_name + '.key_sync.value'
        external_value: root.key_sync_prop
        value_changed_callback: (lambda val: app.set_prop_value_for_param_name(self.param_name, self.value))
        invert_mouse_wheel: app.invert_mouse_wheel
        text_color_string: root.value_color_string


<ParamsGridNonModCell>:
    value_color_string: '#06070FFF'
    orientation: 'vertical'
    corner_radius: self.parent.corner_radius
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]
    canvas.before:
        Color:
            rgba: C(self.background_color_string)
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [root.corner_radius]

    ParamNameLabel:
        text: root.title
        text_color_string: root.param_name_color_string

    FloatValueControl:
        screen_name: root.screen_name
        section_name: root.section_name
        param_name: root.param_name + '.value'
        text_color_string: root.value_color_string
        float_value_decimal_places: app.fine_mode_decimal_places
        enable_float_value: True
        enable_float_drag: app.fine_mode
        fine_mode: app.fine_mode
        invert_mouse_wheel: app.invert_mouse_wheel
        external_value: root.value_prop
        value_changed_callback: (lambda val: app.set_prop_value_for_param_name(self.param_name, self.value))
        size_hint_y: None
        height: app.curr_height * 1/16

    # A placeholder to take up the empty space in the lower
    # part of the cell
    Widget


<PresetIncButton@HoverButton>:
    color: C('#ECBFEBFF') if self.mouse_pressed else C('#06070FFF')
    base_font_size: self.height * 0.7
    font_size: (self.base_font_size * 1.2) if self.mouse_inside_bounds else self.base_font_size
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    disabled: not app.nymphes_connected


<TopBarSpinner@HoverSpinner>:
    color: C('#ECBFEBFF') if self.mouse_pressed else C('#06070FFF')
    base_font_size: self.height * 0.6 if len(self.text) <= 20 else self.height * 0.3
    font_size: (self.base_font_size * 1.08) if self.mouse_inside_bounds else self.base_font_size
    text_size: self.size
    size_hint_y: None
    height: self.parent.height
    halign: 'center' if len(self.text) <= 20 else 'left'
    valign: 'middle'
    background_color: C('#00000000')
    option_cls: 'TopBarSpinnerOption'
    disabled: not app.nymphes_connected
    spacing: self.height * 1/5


<TopBarSpinnerOption@SpinnerOption>:
    color: C('#06070FFF')
    font_size: self.height * 0.75
    text_size: self.size
    size_hint_y: None
    height: app.curr_height * 2/40
    halign: 'center'
    valign: 'middle'
    background_color: C('#1D60C5F5')
    background_normal: ''


<TopBarButton@HoverButton>:
    size_hint_x: 1/6
    size_hint_y: None
    height: self.parent.height
    color: C('#ECBFEBFF') if self.mouse_pressed else C('#06070FFF')
    base_font_size: self.height * 0.45
    text_size: self.size
    halign: 'center'
    valign: 'middle'


<LoadDialog>:
    orientation: 'vertical'
    FileChooserListView:
        id: filechooser
        path: str(app._presets_directory_path)
    BoxLayout:
        size_hint_y: 1/8
        Button:
            text_size: self.size
            font_size: self.height * 0.3
            halign: 'center'
            valign: 'middle'
            text: "CANCEL"
            on_release: root.cancel()

        Button:
            text_size: self.size
            font_size: self.height * 0.3
            halign: 'center'
            valign: 'middle'
            text: "OK"
            on_release: root.load(filechooser.path, filechooser.selection)


<SaveDialog>:
    text_input: text_input
    orientation: "vertical"
    FileChooserListView:
        id: filechooser
        path: str(app._presets_directory_path)
        on_selection: text_input.text = self.selection and self.selection[0] or ''

    TextInput:
        id: text_input
        text: root.default_filename
        text_size: self.size
        font_size: self.height * 0.3
        halign: 'left'
        valign: 'middle'
        size_hint_y: 1/8
        multiline: False

    BoxLayout:
        size_hint_y: 1/8
        Button:
            text_size: self.size
            font_size: self.height * 0.3
            halign: 'center'
            valign: 'middle'
            text: "CANCEL"
            on_release: root.cancel()

        Button:
            text_size: self.size
            font_size: self.height * 0.3
            halign: 'center'
            valign: 'middle'
            text: "OK"
            on_release: root.save(filechooser.path, filechooser.path + '/' + text_input.text)


<ErrorDialog>:
    orientation: 'vertical'

    Label:
        multiline: True
        text: app.error_text
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        font_size: self.height * 1/6

    Label:
        multiline: True
        text: app.error_detail_text
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        font_size: self.height * 1/8

    Button:
        size_hint_y: 1/4
        text_size: self.size
        font_size: self.height * 0.7
        halign: 'center'
        valign: 'middle'
        text: "OK"
        on_release: root.ok()


<NymphesPortsSection@ControlSection>:
    spacing: self.parent.spacing

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    BoxLayout:
        orientation: 'vertical'

        SectionTitleLabel:
            text: 'NYMPHES'

        GridLayout:
            cols: 2
            row_default_height: app.curr_height * 1/16
            row_force_default: True
            spacing: (self.height / 3.0) * 1/10


            # First Row
            NymphesPortSpinnerLabel:
                text: 'INPUT PORT'
                size_hint_x: 3/8

            NymphesPortSpinner:
                size_hint_x: 5/8
                values: app.nymphes_input_spinner_names
                text: app.nymphes_input_name
                on_text: app.nymphes_input_spinner_text_changed(self.text)
                screen_name: 'settings'
                tooltip_text: 'MIDI PORT FOR INPUT FROM NYMPHES'

            # Second Row
            NymphesPortSpinnerLabel:
                text: 'OUTPUT PORT'
                size_hint_x: 3/8

            NymphesPortSpinner:
                size_hint_x: 5/8
                values: app.nymphes_output_spinner_names
                text: app.nymphes_output_name
                on_text: app.nymphes_output_spinner_text_changed(self.text)
                screen_name: 'settings'
                tooltip_text: 'MIDI PORT FOR OUTPUT TO NYMPHES'

            # Third Row
            NymphesPortSpinnerLabel:
                text: 'MIDI CHANNEL'
                size_hint_x: 3/8

            NymphesPortSpinner:
                size_hint_x: 5/8
                values: [str(i) for i in range(1, 17)]
                halign: 'center'
                text: str(app.nymphes_midi_channel)
                on_text: app.on_nymphes_midi_channel_spinner(self.text)
                screen_name: 'settings'
                tooltip_text: 'MIDI CHANNEL FOR COMMUNICATION WITH NYMPHES'


<MidiInputPortsSection@ControlSection>:
    spacing: self.parent.spacing[1]

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    BoxLayout:
        orientation: 'vertical'

        SectionTitleLabel:
            text: 'MIDI INPUTS'

        ScrollView:
            do_scroll_x: False
            do_scroll_y: True

            MidiInputPortsGrid:
                size_hint_y: None
                height: self.minimum_height
                midi_ports: app.detected_midi_input_names_for_gui


<MidiOutputPortsSection@ControlSection>:
    spacing: self.parent.spacing[1]

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    BoxLayout:
        orientation: 'vertical'

        SectionTitleLabel:
            text: 'MIDI OUTPUTS'

        ScrollView:
            do_scroll_x: False
            do_scroll_y: True

            MidiOutputPortsGrid:
                size_hint_y: None
                height: self.minimum_height
                midi_ports: app.detected_midi_output_names_for_gui

<MiscSettingsSection@ControlSection>:
    spacing: self.parent.spacing

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius]

    BoxLayout:
        orientation: 'vertical'

        SectionTitleLabel:
            text: 'MISC'

        BoxLayout:
            orientation: 'vertical'
            spacing: self.height * 1/24

            MiscSettingsButton:
                on_release: app.open_presets_folder_in_native_file_browser()
                size_hint_y: 1/6
                text: 'OPEN PRESETS FOLDER'
                screen_name: 'settings'
                tooltip_text: 'SHOW PRESETS FOLDER IN SYSTEM FILE BROWSER'

            MiscSettingsButton:
                on_release: app.open_logs_folder_in_native_file_browser()
                size_hint_y: 1/6
                text: 'OPEN LOGS FOLDER'
                screen_name: 'settings'
                tooltip_text: 'SHOW LOGS FOLDER IN SYSTEM FILE BROWSER'

            Widget:
                size_hint_y: 4/6


<MidiInputPortsGrid>:
    row_default_height: app.curr_height * 1/16
    row_force_default: True


<MidiOutputPortsGrid>:
    row_default_height: app.curr_height * 1/16
    row_force_default: True


<MidiPortLabel>:
    size_hint_x: 7/8
    color: C('#06070FFF')
    font_size: self.height * 0.5
    text_size: self.size
    halign: 'left'
    valign: 'middle'
    background_color: C('#00000000')


<MidiInputPortCheckBox>:
    size_hint_x: 1/8
    active: self.port_name in app.connected_midi_input_names_for_gui
    on_active: app.midi_input_port_checkbox_toggled(self.port_name, self.active)


<MidiOutputPortCheckBox>:
    size_hint_x: 1/8
    active: self.port_name in app.connected_midi_output_names_for_gui
    on_active: app.midi_output_port_checkbox_toggled(self.port_name, self.active)


<NymphesPortSpinner@HoverSpinner>:
    color: C('#ECBFEBFF') if self.mouse_pressed else C('#06070FFF')
    base_font_size: self.height * 0.5
    font_size: (self.base_font_size * 1.08) if self.mouse_inside_bounds else self.base_font_size
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    background_color: C('#00000000')
    option_cls: 'NymphesPortSpinnerOption'
    spacing: 0


<NymphesPortSpinnerOption@SpinnerOption>:
    color: C('#06070FFF')
    font_size: self.height * 0.5
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    background_color: C('#1D60C5F5')
    background_normal: ''

<NymphesPortSpinnerLabel@Label>:
    color: C('#ECBFEBFF')
    font_size: self.height * 0.4
    text_size: self.size
    halign: 'left'
    valign: 'middle'
    background_color: C('#00000000')


<DashboardBottomBar@BottomBar>:
    orientation: 'horizontal'
    padding: [self.corner_radius * 1, self.corner_radius * 0.25]
    spacing: 0

    canvas.before:
        Color:
            rgba: C('#257CFFFF')

        RoundedRectangle:
            pos: root.pos
            size: root.width, root.height
            radius: [root.corner_radius, root.corner_radius, root.corner_radius, root.corner_radius]

    Label:
        size_hint_x: 22/40
        text: app.status_bar_text
        color: C('#222754FF')
        font_size: self.height * 0.6
        text_size: self.size
        halign: 'left'
        valign: 'middle'

    # Mod Wheel
    Label:
        size_hint_x: 4/40
        text: 'MOD WHEEL'
        color: C('#ECBFEBFF')
        font_size: self.height * 0.6
        text_size: self.size
        halign: 'right'
        valign: 'middle'
        disabled: not app.nymphes_connected

    MidiIntValueControl:
        screen_name: root.screen_name
        param_name: 'mod_wheel'
        text_color_string: '#092042FF'
        invert_mouse_wheel: app.invert_mouse_wheel
        external_value: app.mod_wheel
        value_changed_callback: (lambda val: app.set_prop_value_for_param_name(self.param_name, self.value))
        disabled: not app.nymphes_connected
        tooltip_text: 'SEND MOD WHEEL AMOUNT TO NYMPHES'

        size_hint_x: 2/40


    # Velocity
    Label:
        size_hint_x: 4/40
        text: 'VELOCITY'
        color: C('#ECBFEBFF')
        font_size: self.height * 0.6
        text_size: self.size
        halign: 'right'
        valign: 'middle'
        disabled: not app.nymphes_connected

    Label:
        size_hint_x: 2/40
        text: str(app.velocity)
        color: C('#222754FF') if app.nymphes_connected else C('#ECBFEBFF')
        font_size: self.height * 0.7
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        disabled: not app.nymphes_connected

    # Aftertouch
    Label:
        size_hint_x: 4/40
        text: 'AFTERTOUCH'
        color: C('#ECBFEBFF') if app.nymphes_connected else C('#ECBFEBFF')
        font_size: self.height * 0.6
        text_size: self.size
        halign: 'right'
        valign: 'middle'
        disabled: not app.nymphes_connected

    AftertouchValueLabel:
        screen_name: root.screen_name
        size_hint_x: 2/40
        text_color_string: '#092042FF'


<MidiIntValueControl>:
    base_font_size: self.height * 0.7

#
#    color: C('#EDC0ECFF') if self.mouse_pressed else C(self.text_color_string) if app.nymphes_connected else C('#ECBFEBFF')
#    font_size: (self.base_font_size * 1.08) if self.mouse_inside_bounds else self.base_font_size
#    text_size: self.size
#    halign: 'center'
#    valign: 'middle'
#    text: str(app.mod_wheel)
#    on_touch_down: if self.collide_point(*args[1].pos): self.handle_touch(args[1].device, args[1].button)

<AftertouchValueLabel>:
    color: C('#EDC0ECFF') if self.mouse_pressed else C(self.text_color_string) if app.nymphes_connected else C('#ECBFEBFF')
    base_font_size: self.height * 0.7
    font_size: (self.base_font_size * 1.08) if self.mouse_inside_bounds else self.base_font_size
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    text: str(app.aftertouch)
    on_touch_down: if self.collide_point(*args[1].pos): self.handle_touch(args[1].device, args[1].button)
    disabled: not app.nymphes_connected
    tooltip_text: 'SEND AFTERTOUCH TO NYMPHES'


<ChordParamsGrid>:
    cols: 6
    corner_radius: self.width * 0.03
    spacing: self.width * 0.01


<ChordParamsGridCell>:
    orientation: 'vertical'
    corner_radius: self.parent.corner_radius
    padding: [self.corner_radius * 0.25, self.corner_radius * 0.25]
    canvas.before:
        Color:
            rgba: C(self.background_color_string)
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [root.corner_radius]

    ParamNameLabel:
        text: root.title

    ChordValueControl:
        screen_name: root.screen_name
        section_name: root.section_name
        param_name: root.param_name + '.value'
        external_value: root.value_prop
        value_changed_callback: (lambda val: app.set_prop_value_for_param_name(self.param_name, self.value))
        invert_mouse_wheel: app.invert_mouse_wheel
        text_color_string: root.value_color_string

<ChordSectionTitleLabel>:
    size_hint_y: None
    height: app.curr_height * 1/16
    size_hint_x: 2/5
    background_color: 0, 1, 0, 0.3
    color: C('#ECBFEBFF') if self.this_chord_active or self.mouse_pressed else C('#06070FFF')
    base_font_size: self.height * 0.5
    text_size: self.size
    halign: 'left'
    valign: 'middle'
    disabled: not app.nymphes_connected
    screen_name: 'chords'

<MiscSettingsButton@HoverButton>:
    color: C('#ECBFEBFF') if self.mouse_pressed else C('#06070FFF')
    base_font_size: self.height * 0.6
    text_size: self.size
    halign: 'center'
    valign: 'middle'

<HoverButton>:
    font_size: (self.base_font_size * 1.08) if self.mouse_inside_bounds else self.base_font_size

<ValueControl>:
    text_size: self.size
    halign: 'center'
    font_size: self.base_font_size * self.mouseover_magnification_amount if self.mouse_inside_bounds else self.base_font_size
    padding: 0, self.font_size * 1/20 if self.mouse_inside_bounds else self.font_size * 1/10, 0, 0
    disabled: not app.nymphes_connected

<FloatValueControl>
    base_font_size: self.height * 0.7

<LfoTypeValueControl>:
    base_font_size: self.width * 0.2

<LfoSyncValueControl>:
    base_font_size: self.width * 0.2
    
<ChordValueControl>:
    base_font_size: self.height * 0.7
    